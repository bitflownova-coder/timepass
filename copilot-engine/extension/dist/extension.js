(()=>{"use strict";var e={624(e,t,s){Object.defineProperty(t,"__esModule",{value:!0}),t.AutonomousEngine=void 0;const n=s(188);t.AutonomousEngine=class{constructor(e,t){this.workspacePath="",this.pollTimer=null,this.dashboardListeners=[],this.latestDashboard=null,this.initialized=!1,this.running=!1,this.pollIntervalMs=15e3,this.client=e,this.output=t,this.eventStream=new n.EventStream(t)}async start(e){if(!this.running){this.running=!0,this.workspacePath=e,this.eventStream.start(e),this.eventStream.onEvent(e=>this.onChangeEvent(e));try{this.output.info("[Autonomous] Initializing workspace analysis...");const t=await this.client.post("/autonomous/initialize",{workspace_path:e});this.initialized=!0;const s=t?.steps||{},n=s.index?.entities_found||0,i=s.graph?.file_edges||0;this.output.success(`[Autonomous] Workspace initialized: ${n} entities, ${i} graph edges`)}catch(e){this.output.warn(`[Autonomous] Init failed (engine may be starting): ${e}`)}this.pollTimer=setInterval(()=>this.pollDashboard(),this.pollIntervalMs),this.pollDashboard(),this.output.info("[Autonomous] Runtime started â€” all events are being captured")}}stop(){this.running=!1,this.eventStream.stop(),this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}onDashboardUpdate(e){this.dashboardListeners.push(e),this.latestDashboard&&e(this.latestDashboard)}getLatestDashboard(){return this.latestDashboard}getStats(){return{running:this.running,initialized:this.initialized,eventStream:this.eventStream.getStats(),latestRisk:this.latestDashboard?.health?.risk_scores?.overall_score??null,healthLevel:this.latestDashboard?.health?.risk_scores?.health_level??"UNKNOWN"}}getEventStream(){return this.eventStream}async onChangeEvent(e){if(this.running)try{await this.client.post("/autonomous/event",{file_path:e.file_path,workspace_path:e.workspace_path,change_type:e.change_type,git_branch:e.git_branch})}catch{}}async refreshDashboard(e){const t=e||this.workspacePath;if(t)try{const e=encodeURIComponent(t),s=await this.client.get(`/autonomous/dashboard/${e}`);if(s){this.latestDashboard=s;for(const e of this.dashboardListeners)try{e(s)}catch(e){this.output.warn(`[Autonomous] Dashboard listener error: ${e}`)}return s}}catch(e){this.output.warn(`[Autonomous] Dashboard refresh failed: ${e}`)}return this.latestDashboard}async pollDashboard(){if(this.running&&this.workspacePath)try{const e=encodeURIComponent(this.workspacePath),t=await this.client.get(`/autonomous/dashboard/${e}`);if(t){this.latestDashboard=t;for(const e of this.dashboardListeners)try{e(t)}catch(e){this.output.warn(`[Autonomous] Dashboard listener error: ${e}`)}}}catch{}}dispose(){this.stop()}}},717(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.BackendManager=void 0;const a=r(s(398)),c=r(s(928)),l=r(s(896)),h=s(317);t.BackendManager=class{constructor(e,t){this.context=e,this.process=null,this.port=7779,this.startTime=0,this.healthCheckInterval=null,this.lastLogLines=[],this.maxLogLines=50,this.onStatusChangeCallback=null,this.onProgressCallback=null,this.autoRestart=!0,this.connectedToExternal=!1,this.lastHealthCheck=!1,this.output=t,this.extensionPath=e.extensionPath;const s=a.workspace.getConfiguration("copilotEngine");this.port=s.get("backendPort",7779),this.autoRestart=s.get("autoRestartBackend",!0)}getStartupTimeout(){return 1e3*a.workspace.getConfiguration("copilotEngine").get("backendStartupTimeout",600)}onStatusChange(e){this.onStatusChangeCallback=e}onProgress(e){this.onProgressCallback=e}getStatus(){return{running:null!==this.process&&!this.process.killed||this.connectedToExternal,port:this.port,pid:this.process?.pid||null,uptime:this.startTime?Math.floor((Date.now()-this.startTime)/1e3):0,health:this.determineHealth(),lastLog:this.lastLogLines.slice(-1)[0]||""}}getLogs(){return this.lastLogLines.slice(-20)}async detectExisting(){this.output.info("[DetectExisting] Checking health...");const e=await this.checkHealth();return this.output.info(`[DetectExisting] Health result: ${e}`),e?(this.connectedToExternal||this.process||(this.connectedToExternal=!0,this.lastHealthCheck=!0,this.startTime||(this.startTime=Date.now()),this.startHealthChecks(),this.output.success(`Detected running backend on port ${this.port}`)),this.output.info(`[DetectExisting] Notifying status change, connectedToExternal=${this.connectedToExternal}`),this.notifyStatusChange(),!0):(this.connectedToExternal&&(this.connectedToExternal=!1,this.lastHealthCheck=!1),this.output.info("[DetectExisting] Backend not running, notifying"),this.notifyStatusChange(),!1)}async start(){if(this.process)return this.output.warn("Backend already running"),!0;if(this.output.section("BACKEND MANAGER"),this.output.info(`Checking for backend on port ${this.port}...`),this.notifyStatusChange(),await this.checkHealth())return this.output.success(`Found healthy backend already running on port ${this.port}`),this.connectedToExternal=!0,this.lastHealthCheck=!0,this.startTime=Date.now(),this.startHealthChecks(),a.window.showInformationMessage(`Connected to existing Copilot Engine backend on port ${this.port}`),this.notifyStatusChange(),!0;this.output.info("No existing backend found. Attempting to start new backend...");const e=await this.findPython();if(!e)return this.output.error("Python not found. Please install Python 3.8+ or configure python.pythonPath"),a.window.showErrorMessage("Python not found. Cannot start Copilot Engine backend."),!1;const t=this.findServerScript();if(!t)return this.output.error("server.py not found - cannot start backend locally"),this.output.separator(),this.output.warn("WORKAROUND OPTIONS:"),this.output.info("  1. Start backend manually: cd copilot-engine && python -m uvicorn server:app --port 7779"),this.output.info("  2. Configure path in settings: copilotEngine.serverPath"),this.output.info("  3. Open the timepass workspace which contains copilot-engine folder"),this.output.separator(),a.window.showErrorMessage("Backend server script not found. Start it manually or configure the path."),!1;if(!await this.isPortAvailable(this.port)&&(this.output.warn(`Port ${this.port} is occupied by non-responsive process. Killing it...`),await this.killProcessOnPort(this.port),await this.delay(3e3),!await this.isPortAvailable(this.port)))return this.output.error(`Failed to free port ${this.port}. Please close any process using this port manually.`),a.window.showErrorMessage(`Port ${this.port} is still in use. Cannot start backend.`),!1;const s=c.dirname(t);this.process=(0,h.spawn)(e,["-m","uvicorn","server:app","--host","127.0.0.1","--port",this.port.toString()],{cwd:s,shell:!1,detached:!1,stdio:["ignore","pipe","pipe"]}),this.startTime=Date.now(),this.process.stdout&&this.process.stdout.on("data",e=>{const t=e.toString().split("\n").filter(e=>e.trim());this.lastLogLines.push(...t),this.lastLogLines.length>this.maxLogLines&&(this.lastLogLines=this.lastLogLines.slice(-this.maxLogLines)),t.forEach(e=>{this.output.info(`[Backend] ${e}`),(e.includes("Scanning:")||e.includes("Step ")||e.includes("Found ")||e.includes("initialization"))&&this.notifyProgress(e)}),this.notifyStatusChange()}),this.process.stderr&&this.process.stderr.on("data",e=>{const t=e.toString().split("\n").filter(e=>e.trim());this.lastLogLines.push(...t),this.lastLogLines.length>this.maxLogLines&&(this.lastLogLines=this.lastLogLines.slice(-this.maxLogLines)),t.forEach(e=>{e.toLowerCase().includes("error")||e.toLowerCase().includes("exception")||e.toLowerCase().includes("traceback")?this.output.error(`[Backend ERROR] ${e}`):e.toLowerCase().includes("warning")?this.output.warn(`[Backend WARN] ${e}`):this.output.warn(`[Backend] ${e}`)}),this.notifyStatusChange()}),this.process.on("exit",(e,t)=>{this.output.warn(`Backend exited (code=${e}, signal=${t})`),this.process=null,this.notifyStatusChange(),this.autoRestart&&0!==e&&(this.output.info("Auto-restarting backend in 5 seconds..."),setTimeout(()=>this.start(),5e3))}),this.process.on("error",e=>{this.output.error(`Backend error: ${e.message}`),this.process=null,this.notifyStatusChange()});const n=this.getStartupTimeout(),i=Math.floor(n/6e4);if(this.output.info(`Waiting for backend to initialize (timeout: ${i} min)...`),await this.waitForHealthy(n))return this.output.success(`Backend started on port ${this.port} (PID ${this.process?.pid})`),this.startHealthChecks(),a.window.showInformationMessage(`Copilot Engine backend started on port ${this.port}`),!0;{this.output.error(`Backend failed to become healthy within ${i} minutes`),this.output.separator(),this.output.error("RECENT BACKEND LOGS:");const e=this.lastLogLines.slice(-10);return e.length>0?e.forEach(e=>this.output.info(`  ${e}`)):this.output.warn("  No log output captured - backend may have crashed immediately"),this.output.separator(),this.output.error("TROUBLESHOOTING:"),this.output.info("  1. Check if Python 3.8+ is installed"),this.output.info("  2. Check if required packages are installed: pip install -r requirements.txt"),this.output.info(`  3. Check if port ${this.port} is in use: Get-NetTCPConnection -LocalPort ${this.port}`),this.output.info("  4. Try starting manually in terminal to see full errors"),this.output.info("  5. Check server.py exists in copilot-engine folder"),this.output.separator(),this.output.warn("Large projects may take longer. Increase copilotEngine.backendStartupTimeout in settings."),this.stop(),a.window.showErrorMessage("Backend startup timeout - check Output panel for error details"),!1}}stop(){if(this.healthCheckInterval&&(clearInterval(this.healthCheckInterval),this.healthCheckInterval=null),this.connectedToExternal)return this.output.info("Disconnecting from external backend..."),this.connectedToExternal=!1,this.lastHealthCheck=!1,this.notifyStatusChange(),this.output.success("Disconnected from backend"),void a.window.showInformationMessage("Disconnected from Copilot Engine backend");if(this.process){this.output.info("Stopping backend..."),this.autoRestart=!1;try{this.process.kill("SIGTERM"),setTimeout(()=>{this.process&&!this.process.killed&&this.process.kill("SIGKILL")},5e3)}catch(e){this.output.error(`Error stopping backend: ${e.message}`)}this.process=null,this.lastHealthCheck=!1,this.notifyStatusChange(),this.output.success("Backend stopped"),a.window.showInformationMessage("Copilot Engine backend stopped")}else this.output.info("Backend not running")}async restart(){return this.output.info("Restarting backend..."),this.stop(),await this.delay(3e3),await this.start()}dispose(){this.healthCheckInterval&&clearInterval(this.healthCheckInterval),this.process&&this.process.kill("SIGKILL")}determineHealth(){return this.connectedToExternal?this.lastHealthCheck?"healthy":"unhealthy":this.process?Math.floor((Date.now()-this.startTime)/1e3)<10?"starting":this.lastHealthCheck?"healthy":"starting":"stopped"}async findPython(){const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(e){const t=[c.join(e,".venv","Scripts","python.exe"),c.join(e,"venv","Scripts","python.exe"),c.join(e,".venv","bin","python"),c.join(e,"venv","bin","python")];for(const e of t)if(l.existsSync(e))return this.output.info(`Using venv: ${e}`),e}if(a.extensions.getExtension("ms-python.python")){const e=a.workspace.getConfiguration("python"),t=e.get("defaultInterpreterPath")||e.get("pythonPath");if(t&&l.existsSync(t))return this.output.info(`Using Python extension: ${t}`),t}const t=["python","python3","python.exe","python3.exe"];for(const e of t)try{const{execSync:t}=s(317),n=t(`where ${e}`,{encoding:"utf-8",stdio:"pipe"}).split("\n")[0].trim();if(n&&l.existsSync(n))return this.output.info(`Using system Python: ${n}`),n}catch{}return null}findServerScript(){const e=a.workspace.getConfiguration("copilotEngine").get("serverPath","");if(e&&l.existsSync(e))return this.output.info(`Using configured server path: ${e}`),e;const t=[];t.push(c.join(this.extensionPath,"..","server.py")),t.push(c.join(this.extensionPath,"..","..","server.py"));const s=a.workspace.workspaceFolders||[];for(const e of s)t.push(c.join(e.uri.fsPath,"copilot-engine","server.py")),t.push(c.join(e.uri.fsPath,"server.py"));const n=process.env.USERPROFILE||process.env.HOME||"";t.push(c.join(n,"copilot-engine","server.py")),t.push(c.join(n,"projects","copilot-engine","server.py"));for(const e of s){let s=e.uri.fsPath;for(let e=0;e<5;e++){const e=c.dirname(s);if(e===s)break;s=e,t.push(c.join(s,"copilot-engine","server.py"))}}t.push("D:\\Bitflow_softwares\\timepass\\copilot-engine\\server.py"),t.push("C:\\Users\\prati\\copilot-engine\\server.py");const i=[...new Set(t)];this.output.info(`Searching for server.py in ${i.length} locations...`);for(const e of i)if(l.existsSync(e))return this.output.success(`Found server.py: ${e}`),e;return this.output.error("server.py not found! Searched in:"),i.forEach((e,t)=>{this.output.info(`  ${t+1}. ${e}`)}),this.output.separator(),this.output.warn("TIP: Configure the path in settings: copilotEngine.serverPath"),null}async checkHealth(){try{const e=s(611);return await new Promise(t=>{const s=e.get(`http://127.0.0.1:${this.port}/health`,e=>{e.resume(),t(200===e.statusCode)});s.on("error",e=>{this.output.warn(`Health check error: ${e.message}`),t(!1)}),s.setTimeout(5e3,()=>{this.output.warn("Health check timeout"),s.destroy(),t(!1)})})}catch(e){return this.output.warn(`Health check exception: ${e}`),!1}}async isPortAvailable(e){try{const t=s(611).createServer();return new Promise(s=>{t.once("error",()=>s(!1)),t.once("listening",()=>{t.close(),s(!0)}),t.listen(e,"127.0.0.1")})}catch{return!1}}async killProcessOnPort(e){try{const{execSync:t}=s(317);"win32"===process.platform?(t(`powershell -Command "$conns = Get-NetTCPConnection -LocalPort ${e} -ErrorAction SilentlyContinue; $conns.OwningProcess | ForEach-Object { Stop-Process -Id $_ -Force -ErrorAction SilentlyContinue }"`,{stdio:"ignore"}),this.output.info(`Killed existing process on port ${e}`)):t(`lsof -ti:${e} | xargs kill -9`,{stdio:"ignore"})}catch(t){this.output.warn(`Could not kill process on port ${e}: ${t}`)}}async waitForHealthy(e){const t=Date.now();let n=0;const i=Math.floor(e/6e4);for(;Date.now()-t<e;){try{const e=s(611);if(await new Promise(t=>{const s=e.get(`http://127.0.0.1:${this.port}/health`,e=>{t(200===e.statusCode)});s.on("error",()=>t(!1)),s.setTimeout(2e3,()=>{s.destroy(),t(!1)})}))return!0}catch{}const e=Date.now()-t;if(e-n>=5e3){const t=Math.floor(e/1e3),s=`Waiting for backend... (${t}s / ${i}min)`;if(this.output.info(`â³ ${s}`),this.notifyProgress(s),t>60&&t%30==0){const e=`Large projects (1000+ files) may take ${i} minutes to scan all files...`;this.output.info(`   ${e}`),this.notifyProgress(e)}n=e}await this.delay(1e3)}return!1}startHealthChecks(){this.healthCheckInterval&&clearInterval(this.healthCheckInterval);let e=0;this.healthCheckInterval=setInterval(async()=>{if(this.process||this.connectedToExternal)try{const t=s(611),n=Date.now(),i=await new Promise(e=>{const s=t.get(`http://127.0.0.1:${this.port}/health`,t=>{t.resume(),this.output.info(`[HealthCheck] Response status=${t.statusCode} in ${Date.now()-n}ms`),e(200===t.statusCode)});s.on("error",t=>{this.output.warn(`[HealthCheck] Error: ${t.message}`),e(!1)}),s.setTimeout(1e4,()=>{this.output.warn("[HealthCheck] Timeout after 10s"),s.destroy(),e(!1)})});this.lastHealthCheck=i,i?e=0:(e++,this.connectedToExternal?e>=3?(this.output.warn(`External backend unresponsive after ${e} failed checks`),this.connectedToExternal=!1,e=0):this.output.warn(`External backend health check failed (${e}/3)`):this.autoRestart&&e>=3?(this.output.warn(`Backend health check failed ${e} times. Restarting...`),e=0,await this.restart()):e<3&&this.output.warn(`Backend health check failed (${e}/3 before restart)`)),this.notifyStatusChange()}catch{this.lastHealthCheck=!1,this.notifyStatusChange()}},15e3)}notifyStatusChange(){const e=this.getStatus();this.output.info(`[NotifyStatus] running=${e.running}, health=${e.health}, hasCallback=${!!this.onStatusChangeCallback}`),this.onStatusChangeCallback&&this.onStatusChangeCallback(e)}notifyProgress(e){this.onProgressCallback&&this.onProgressCallback(e)}delay(e){return new Promise(t=>setTimeout(t,e))}}},270(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.BehaviorTracker=void 0;const a=r(s(398)),c=s(28);t.BehaviorTracker=class{constructor(e,t,s){this.disposables=[],this.fileSwitchCount=0,this.errorRepeatMap=new Map,this.recentErrors=[],this.focusModeActive=!1,this.sessionStartTime=Date.now(),this.lastFileSwitch=Date.now(),this.rapidSwitchCount=0,this.client=e,this.output=t,this.statusBar=s}start(){const e=a.window.onDidChangeActiveTextEditor(e=>{e&&this.onFileSwitch(e.document.uri.fsPath)});this.disposables.push(e);const t=a.workspace.onDidSaveTextDocument(e=>{this.trackEvent("file_save",{file:e.uri.fsPath})});this.disposables.push(t),this.output.success("Behavior tracking started")}trackError(e,t){const s=`${e}:${t.substring(0,50)}`,n=(this.errorRepeatMap.get(s)||0)+1;this.errorRepeatMap.set(s,n),this.recentErrors.push(s),this.recentErrors.length>20&&this.recentErrors.shift(),n>=(0,c.getConfig)().focusModeThreshold&&!this.focusModeActive&&this.suggestFocusMode(e,t,n),this.trackEvent("error",{error_type:e,count:n})}onFileSwitch(e){this.fileSwitchCount++;const t=Date.now(),s=t-this.lastFileSwitch;this.lastFileSwitch=t,s<3e3?this.rapidSwitchCount++:this.rapidSwitchCount=Math.max(0,this.rapidSwitchCount-1),this.rapidSwitchCount>=10&&!this.focusModeActive&&(a.window.showInformationMessage("ðŸ¤” Rapid file switching detected. Need help finding something?","Search Codebase","Build Context","Dismiss").then(e=>{"Build Context"===e&&a.commands.executeCommand("copilotEngine.buildContext")}),this.rapidSwitchCount=0),this.trackEvent("file_switch",{file:e})}async suggestFocusMode(e,t,s){switch(await a.window.showWarningMessage(`ðŸ”¥ You've hit "${e}" ${s} times. Activate Focus Mode for structured debugging?`,"Activate Focus Mode","Find Similar Fixes","Not Now")){case"Activate Focus Mode":this.activateFocusMode();break;case"Find Similar Fixes":const s=`${e}: ${t}`;try{const e=await this.client.findSimilarErrors(s);if(this.output.show(),this.output.section("SIMILAR PAST ERRORS"),e.similar_fixes&&e.similar_fixes.length>0)for(const t of e.similar_fixes)this.output.info(`Fix: ${t.description}`),this.output.info(`  How: ${t.fix}`),this.output.info(`  Used ${t.success_count} times`),this.output.separator();else this.output.info("No similar fixes found yet. This will improve over time.")}catch{this.output.warn("Could not fetch similar errors")}}}activateFocusMode(){this.focusModeActive=!0,this.statusBar.setStatus("focus-mode"),this.output.show(),this.output.section("ðŸ”¥ FOCUS MODE ACTIVATED"),this.output.info("Full context capture enabled"),this.output.info("All errors will be logged with maximum detail"),this.output.info("Use Ctrl+Shift+C to build context at any time"),this.output.separator(),a.window.showInformationMessage("ðŸ”¥ Focus Mode Active - Enhanced debugging enabled","Deactivate").then(e=>{"Deactivate"===e&&this.deactivateFocusMode()})}deactivateFocusMode(){this.focusModeActive=!1,this.statusBar.setStatus("connected"),this.errorRepeatMap.clear(),this.output.success("Focus Mode deactivated")}isFocusModeActive(){return this.focusModeActive}async trackEvent(e,t){try{const s=a.workspace.workspaceFolders?.[0]?.uri.fsPath;s&&await this.client.trackBehavior(s,e,t)}catch{}}getStats(){return{session_duration_minutes:Math.round((Date.now()-this.sessionStartTime)/6e4),file_switches:this.fileSwitchCount,unique_errors:this.errorRepeatMap.size,total_errors:this.recentErrors.length,focus_mode:this.focusModeActive,rapid_switches:this.rapidSwitchCount}}dispose(){for(const e of this.disposables)e.dispose()}}},718(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.CopilotCodeLensProvider=void 0,t.registerCodeLensCommands=function(e,t,s){e.subscriptions.push(a.commands.registerCommand("copilotEngine.analyzeFunction",async(e,n,i)=>{const o=await a.workspace.openTextDocument(e),r=d(o,n.start.line),c=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(c){s.show(),s.section(`ANALYSIS: ${i}()`),s.info("Analyzing function...");try{const e=await t.buildContext(c,`Analyze this function for bugs, performance issues, and improvement opportunities:\n\n${r}`,o.uri.fsPath);s.info(e.prompt),s.info(`\nTokens: ${e.token_estimate}`),await a.env.clipboard.writeText(e.prompt),a.window.showInformationMessage(`Analysis for ${i}() copied to clipboard`)}catch(e){s.error(`Analysis failed: ${e.message}`)}}})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.generateTests",async(e,n,i)=>{const o=await a.workspace.openTextDocument(e),r=d(o,n.start.line),c=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(c){s.show(),s.section(`TEST GENERATION: ${i}()`);try{const e=await t.buildContext(c,`Generate comprehensive unit tests for this function. Include edge cases, error cases, and happy path tests:\n\n${r}`,o.uri.fsPath);s.info(e.prompt),await a.env.clipboard.writeText(e.prompt),a.window.showInformationMessage(`Test prompt for ${i}() copied to clipboard`)}catch(e){s.error(`Test generation failed: ${e.message}`)}}})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.securityCheckLens",async(e,n,i)=>{s.show(),s.section(`SECURITY CHECK: ${i}()`);try{const n=await t.scanSecurity(e.fsPath);if(0===n.length)s.success("No security issues found!"),a.window.showInformationMessage(`âœ… ${i}(): No security issues`);else{for(const e of n)s.warn(`[${e.severity}] Line ${e.line}: ${e.issue}`),s.info(`  Fix: ${e.suggestion}`);a.window.showWarningMessage(`âš ï¸ ${i}(): ${n.length} security issues found`,"View Details").then(e=>{"View Details"===e&&s.show()})}}catch(e){s.error(`Security check failed: ${e.message}`)}})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.improveCode",async(e,n,i)=>{const o=await a.workspace.openTextDocument(e),r=d(o,n.start.line),c=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(c)try{const e=await t.optimizePrompt(c,`Improve this code for readability, performance, and best practices. Show refactored version with explanation:\n\n${r}`,o.uri.fsPath),s=await a.window.showTextDocument(o),l=new a.Position(n.start.line,0),h=o.languageId,d="python"===h?'"""':"*/",u=`${"python"===h?'"""':"/*"}\nCopilot Context:\n- Task: Improve ${i}()\n- Framework: ${e.metadata.project||"N/A"}\n- Focus: readability, performance, best practices\n${d}\n`;await s.edit(e=>{e.insert(l,u)}),a.window.showInformationMessage(`Context injected for ${i}() - Copilot will see it!`)}catch(e){s.error(`Improve failed: ${e.message}`)}})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.checkImpact",async(e,n,i)=>{const o=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(o){s.show(),s.section(`IMPACT ANALYSIS: ${i}()`),s.info("Analyzing change impact...");try{const n=await t.analyzeImpact(o,e.fsPath),r="critical"===n.risk_level?"ðŸ”´":"high"===n.risk_level?"ðŸŸ ":"medium"===n.risk_level?"ðŸŸ¡":"ðŸŸ¢";if(s.info(`${r} Risk: ${n.risk_level} (${n.risk_score.toFixed(2)})`),s.info(`Category: ${n.category}`),n.impact_radius.length>0){s.separator(),s.info(`Affected files (${n.impact_radius.length}):`);for(const e of n.impact_radius)s.info(`  â†’ ${e}`)}if(n.breaking_changes.length>0){s.separator(),s.warn("Breaking changes:");for(const e of n.breaking_changes)s.warn(`  ! ${e}`)}const c="critical"===n.risk_level||"high"===n.risk_level?`âš ï¸ ${i}(): ${n.risk_level.toUpperCase()} impact â€” ${n.impact_radius.length} files affected`:`âœ… ${i}(): ${n.risk_level} impact`;a.window.showInformationMessage(c,"View Details").then(e=>{"View Details"===e&&s.show()})}catch(e){s.error(`Impact analysis failed: ${e.message}`)}}}))};const a=r(s(398)),c=s(28),l={python:[/^(\s*)(async\s+)?def\s+(\w+)\s*\(/gm,/^(\s*)class\s+(\w+)/gm],javascript:[/^(\s*)(async\s+)?function\s+(\w+)\s*\(/gm,/^(\s*)(export\s+)?(const|let|var)\s+(\w+)\s*=\s*(async\s+)?\(/gm,/^(\s*)(export\s+)?(const|let|var)\s+(\w+)\s*=\s*(async\s+)?function/gm,/^(\s*)class\s+(\w+)/gm],typescript:[/^(\s*)(async\s+)?function\s+(\w+)\s*[\(<]/gm,/^(\s*)(export\s+)?(const|let|var)\s+(\w+)\s*=\s*(async\s+)?\(/gm,/^(\s*)(export\s+)?(const|let|var)\s+(\w+)\s*=\s*(async\s+)?function/gm,/^(\s*)class\s+(\w+)/gm,/^(\s*)(public|private|protected)?\s*(async\s+)?(\w+)\s*\(/gm],java:[/^(\s*)(public|private|protected)\s+(static\s+)?\w+\s+(\w+)\s*\(/gm,/^(\s*)(public|private|protected)?\s*class\s+(\w+)/gm],go:[/^func\s+(\w+)\s*\(/gm,/^func\s+\(\w+\s+\*?\w+\)\s+(\w+)\s*\(/gm],rust:[/^(\s*)(pub\s+)?(async\s+)?fn\s+(\w+)/gm,/^(\s*)(pub\s+)?struct\s+(\w+)/gm,/^(\s*)(pub\s+)?impl\s+(\w+)/gm]},h={python:"python",javascript:"javascript",javascriptreact:"javascript",typescript:"typescript",typescriptreact:"typescript",java:"java",go:"go",rust:"rust"};function d(e,t){const s=[],n=e.lineAt(t).firstNonWhitespaceCharacterIndex;for(let i=t;i<Math.min(e.lineCount,t+100);i++){const o=e.lineAt(i);if(s.push(o.text),i>t&&o.text.trim().length>0&&o.firstNonWhitespaceCharacterIndex<=n&&!o.text.trim().startsWith("}")&&!o.text.trim().startsWith(")")&&!o.text.trim().startsWith("]")&&/^(\s*)(def |class |function |const |let |var |export |pub |fn |func )/.test(o.text)){s.pop();break}}return s.join("\n")}t.CopilotCodeLensProvider=class{constructor(e,t){this._onDidChangeCodeLenses=new a.EventEmitter,this.onDidChangeCodeLenses=this._onDidChangeCodeLenses.event,this.client=e,this.output=t}provideCodeLenses(e){if(!(0,c.getConfig)().codeLensEnabled)return[];const t=h[e.languageId];if(!t)return[];const s=l[t];if(!s)return[];const n=[],i=e.getText();for(const o of s){let s;for(o.lastIndex=0;null!==(s=o.exec(i));){const i=e.positionAt(s.index).line,o=new a.Range(i,0,i,0),r=this.extractFunctionName(s,t);!r||r.startsWith("_")&&"__init__"!==r||(n.push(new a.CodeLens(o,{title:"ðŸ” Analyze",command:"copilotEngine.analyzeFunction",arguments:[e.uri,o,r]})),n.push(new a.CodeLens(o,{title:"ðŸ§ª Test",command:"copilotEngine.generateTests",arguments:[e.uri,o,r]})),n.push(new a.CodeLens(o,{title:"ðŸ›¡ï¸ Security",command:"copilotEngine.securityCheckLens",arguments:[e.uri,o,r]})),n.push(new a.CodeLens(o,{title:"ðŸ§  Improve",command:"copilotEngine.improveCode",arguments:[e.uri,o,r]})),n.push(new a.CodeLens(o,{title:"ðŸ’¥ Impact",command:"copilotEngine.checkImpact",arguments:[e.uri,o,r]})))}}return n}extractFunctionName(e,t){for(let t=e.length-1;t>=1;t--)if(e[t]&&/^\w+$/.test(e[t])&&!["async","function","const","let","var","export","public","private","protected","static","pub","def","class","func","fn","struct","impl"].includes(e[t]))return e[t];return null}refresh(){this._onDidChangeCodeLenses.fire()}}},916(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.registerCommands=function(e,t,s,n,i,o,r,l,h,d,u){e.subscriptions.push(a.commands.registerCommand("copilotEngine.start",async()=>{if(n.setStatus("connecting"),s.section("ENGINE START"),await t.isRunning()){n.setStatus("connected"),s.success("Engine already running!"),a.window.showInformationMessage("âš¡ Copilot Engine is running");const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(e)try{const n=await t.registerWorkspace(e,a.workspace.name);s.success(`Workspace registered: ${n.name||n.path} (${n.language||"unknown"})`),t.connectWebSocket(e)}catch(e){s.warn(`Workspace registration failed: ${e.message}`)}return}if(await u.start()){const e=await t.checkHealth();if(e){n.setStatus("connected"),s.success(`Engine connected! Version ${e.version}`);const i=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(i)try{await t.registerWorkspace(i,a.workspace.name),t.connectWebSocket(i)}catch(e){s.warn(`Workspace registration: ${e.message}`)}a.window.showInformationMessage("âš¡ Copilot Engine started")}else n.setStatus("connected"),s.success("Engine started (health check pending)")}else n.setStatus("error")})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.stop",async()=>{t.disconnect(),h.stop(),n.setStatus("disconnected"),s.info("Engine disconnected"),a.window.showInformationMessage("Copilot Engine stopped")})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.showStatus",async()=>{s.show(),s.section("ENGINE STATUS");const e=await t.checkHealth();e?(s.success(`Status: ${e.status}`),s.info(`Version: ${e.version}`),s.info(`Uptime: ${Math.round(e.uptime)}s`),s.info(`Watched Workspaces: ${e.watched_workspaces.join(", ")||"none"}`)):s.error("Engine is not running");const n=r.getStats();s.separator(),s.info(`Session Duration: ${n.session_duration_minutes} min`),s.info(`File Switches: ${n.file_switches}`),s.info(`Errors Tracked: ${n.total_errors}`),s.info("Focus Mode: "+(n.focus_mode?"ACTIVE":"Off"))})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.clearHistory",()=>{o.clearDiagnostics(),s.info("Error history and diagnostics cleared"),a.window.showInformationMessage("History cleared")})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.analyzeCode",async()=>{const e=a.window.activeTextEditor;if(!e)return void a.window.showWarningMessage("No active editor");const n=e.selection;let i;i=n.isEmpty?e.document.getText():e.document.getText(n);const o=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(o){s.show(),s.section("CODE ANALYSIS"),s.info("Building analysis context...");try{const n=await t.buildContext(o,`Analyze this code for:\n1. Bugs and potential issues\n2. Performance problems\n3. Security vulnerabilities\n4. Code style improvements\n5. Best practice violations\n\nCode:\n\`\`\`\n${i}\n\`\`\``,e.document.uri.fsPath);s.separator(),s.info(n.prompt),s.info(`\nToken estimate: ${n.token_estimate}`),await a.env.clipboard.writeText(n.prompt),a.window.showInformationMessage("Analysis context copied to clipboard!")}catch(e){s.error(`Analysis failed: ${e.message}`)}}})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.buildContext",async()=>{const e=await a.window.showInputBox({prompt:"What are you trying to do?",placeHolder:"e.g., Fix the authentication bug, Add pagination to the API"});if(!e)return;const n=a.workspace.workspaceFolders?.[0]?.uri.fsPath,i=a.window.activeTextEditor?.document.uri.fsPath;if(n){s.show(),s.section("CONTEXT BUILD"),s.info(`Task: ${e}`);try{const o=await t.buildContext(n,e,i);s.separator(),s.info(o.prompt),s.info(`\nTokens: ${o.token_estimate}`),await a.env.clipboard.writeText(o.prompt),a.window.showInformationMessage("Context copied to clipboard! Paste into Copilot Chat.")}catch(e){s.error(`Context build failed: ${e.message}`)}}})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.checkSecurity",async()=>{s.show(),await o.scanWorkspace()})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.findSimilarErrors",async()=>{const e=await a.window.showInputBox({prompt:"Paste the error message",placeHolder:"TypeError: Cannot read property..."});if(e){s.show(),s.section("SIMILAR ERROR SEARCH");try{const n=await t.parseError(e);if(s.info(`Error Type: ${n.error_type}`),s.info(`Message: ${n.message}`),n.suggestions.length>0){s.separator(),s.info("Suggestions:");for(const e of n.suggestions)s.info(`  â†’ ${e}`)}const i=await t.findSimilarErrors(e);if(i?.similar_fixes?.length>0){s.separator(),s.info("Past Fixes:");for(const e of i.similar_fixes)s.info(`  âœ… ${e.description} (used ${e.success_count}x)`)}}catch(e){s.error(`Search failed: ${e.message}`)}}})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.injectContext",async()=>{await i.injectContextAtCursor()})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.showDashboard",()=>{c.DashboardPanel.show(e,t,d,u)})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.startBackend",async()=>{await u.start()})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.stopBackend",()=>{u.stop()})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.restartBackend",async()=>{await u.restart()})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.toggleFocusMode",()=>{r.isFocusModeActive()?r.deactivateFocusMode():r.activateFocusMode()})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.analyzeGitChanges",async()=>{const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(e){s.show(),s.section("GIT CHANGE ANALYSIS");try{const n=await t.analyzeGitDiff(e);if(s.info(`Risk Score: ${n.risk_score}/10`),n.warnings.length>0){s.separator(),s.warn("Warnings:");for(const e of n.warnings)s.warn(`  âš ï¸ ${e}`)}s.separator(),s.info(`Changed Files (${n.changes.length}):`);for(const e of n.changes){const t="high"===e.risk_level?"ðŸ”´":"medium"===e.risk_level?"ðŸŸ¡":"ðŸŸ¢";s.info(`  ${t} ${e.file} [${e.change_type}]`)}}catch(e){s.error(`Git analysis failed: ${e.message}`)}}})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.detectEndpoints",async()=>{const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(e){s.show(),s.section("API ENDPOINT DETECTION");try{const n=await t.detectEndpoints(e);if(n.endpoints&&n.endpoints.length>0)for(const e of n.endpoints)s.info(`  ${e.method} ${e.route} â†’ ${e.file}:${e.line}`);else s.info("No API endpoints detected")}catch(e){s.error(`Detection failed: ${e.message}`)}}})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.fullScan",async()=>{const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(e){s.show(),s.section("FULL ENFORCEMENT SCAN"),n.setStatus("connecting");try{const i=await t.fullScan(e),o="critical"===i.risk_level?"ðŸ”´":"high"===i.risk_level?"ðŸŸ ":"medium"===i.risk_level?"ðŸŸ¡":"ðŸŸ¢";if(s.info(`${o} Risk: ${i.risk_level.toUpperCase()} (score ${i.risk_score}/100)`),s.separator(),i.issues.length>0){s.warn(`Found ${i.issues.length} issue(s):`);for(const e of i.issues){const t="error"===e.severity?"âŒ":"warning"===e.severity?"âš ï¸":"â„¹ï¸";s.info(`  ${t} [${e.category}] ${e.message}`),e.file&&s.info(`     â†’ ${e.file}${e.line?":"+e.line:""}`)}}else s.success("No issues found â€” codebase is clean!");if(i.summary){s.separator();for(const[e,t]of Object.entries(i.summary))s.info(`  ${e}: ${t}`)}n.setStatus("connected"),a.window.showInformationMessage(`${o} Scan complete: ${i.issues.length} issue(s), risk ${i.risk_level}`)}catch(e){n.setStatus("connected"),s.error(`Full scan failed: ${e.message}`)}}})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.preCommitCheck",async()=>{const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(e){s.show(),s.section("PRE-COMMIT VALIDATION");try{let n=[];try{const s=await t.analyzeGitDiff(e);n=s.changes?.map(e=>e.file)||[]}catch{s.warn("Could not detect git changes, scanning workspace...")}const i=await t.preCommitValidation(e,n),o="critical"===i.risk_level?"ðŸ”´":"high"===i.risk_level?"ðŸŸ ":"medium"===i.risk_level?"ðŸŸ¡":"ðŸŸ¢";if(0===i.issues.length)s.success("âœ… Commit is SAFE â€” no enforcement violations"),a.window.showInformationMessage("âœ… Pre-commit: All clear!");else{const e=i.issues.filter(e=>"error"===e.severity),t=i.issues.filter(e=>"warning"===e.severity);s.warn(`${o} Found ${e.length} error(s), ${t.length} warning(s)`),s.separator();for(const e of i.issues){const t="error"===e.severity?"âŒ":"âš ï¸";s.info(`  ${t} [${e.category}] ${e.message}`),e.file&&s.info(`     â†’ ${e.file}`)}e.length>0?"Commit Anyway"!==await a.window.showWarningMessage(`âš ï¸ ${e.length} error(s) found. Commit anyway?`,"Commit Anyway","Cancel")&&s.info("Commit aborted by user"):a.window.showInformationMessage(`${o} Pre-commit: ${t.length} warning(s), no blocking errors`)}}catch(e){s.error(`Pre-commit check failed: ${e.message}`)}}})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.validateContracts",async()=>{const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(e){s.show(),s.section("API CONTRACT VALIDATION");try{const n=(await t.validateContracts(e)).violations||[];if(0===n.length)s.success("âœ… All API contracts valid"),a.window.showInformationMessage("âœ… API contracts: No violations");else{s.warn(`Found ${n.length} contract violation(s):`);for(const e of n)s.info(`  âŒ ${e.rule}: ${e.message}`),e.endpoint&&s.info(`     â†’ ${e.endpoint}`),e.suggestion&&s.info(`     ðŸ’¡ ${e.suggestion}`);a.window.showWarningMessage(`âš ï¸ ${n.length} API contract violation(s) found`)}}catch(e){s.error(`Contract validation failed: ${e.message}`)}}})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.validateSchema",async()=>{const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(e){s.show(),s.section("SCHEMA / PRISMA VALIDATION");try{const n=(await t.analyzePrisma(e)).issues||[];if(0===n.length)s.success("âœ… Schema is clean â€” no issues found"),a.window.showInformationMessage("âœ… Schema validation passed");else{s.warn(`Found ${n.length} schema issue(s):`);for(const e of n){const t="error"===e.severity?"âŒ":"âš ï¸";s.info(`  ${t} [${e.category}] ${e.message}`),e.model&&s.info(`     â†’ Model: ${e.model}`)}a.window.showWarningMessage(`âš ï¸ ${n.length} schema issue(s) found`)}}catch(e){s.error(`Schema validation failed: ${e.message}`)}}})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.removeContext",async()=>{a.window.activeTextEditor?await i.removeContextBlock():a.window.showWarningMessage("No active editor")})),e.subscriptions.push(a.commands.registerCommand("copilotEngine.detectStack",async()=>{const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(e){s.show(),s.section("STACK DETECTION");try{const n=await t.detectStack(e);if(s.info(`Language:  ${n.languages?.join(", ")||"unknown"}`),s.info(`Framework: ${n.frameworks?.join(", ")||"unknown"}`),s.info(`ORM:       ${n.orm||"none"}`),s.info(`API Style: ${n.api_style||"unknown"}`),n.detected_files&&n.detected_files.length>0){s.separator(),s.info("Key files detected:");for(const e of n.detected_files)s.info(`  ðŸ“„ ${e}`)}a.window.showInformationMessage(`Stack: ${n.languages?.[0]||"?"} / ${n.frameworks?.[0]||"?"} / ${n.orm||"no ORM"}`)}catch(e){s.error(`Stack detection failed: ${e.message}`)}}}))};const a=r(s(398)),c=s(417)},28(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.getConfig=c,t.getBaseUrl=function(){const e=c();return`http://${e.host}:${e.port}`},t.getWsUrl=function(){const e=c();return`ws://${e.host}:${e.port}`};const a=r(s(398));function c(){const e=a.workspace.getConfiguration("copilotEngine");return{host:e.get("host","127.0.0.1"),port:e.get("port",7779),autoStart:e.get("autoStart",!0),terminalCapture:e.get("terminalCapture",!0),codeLensEnabled:e.get("codeLensEnabled",!0),securityWarnings:e.get("securityWarnings",!0),notificationLevel:e.get("notificationLevel","errors"),debugMode:e.get("debugMode",!1),autoInjectContext:e.get("autoInjectContext",!1),focusModeThreshold:e.get("focusModeThreshold",5),enginePath:e.get("enginePath","")}}},619(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.EngineClient=void 0;const a=r(s(611)),c=s(28);t.EngineClient=class{constructor(e){this.ws=null,this.connected=!1,this.reconnectTimer=null,this.wsCallbacks=new Map,this.inflightRequests=new Map,this.output=e}async request(e,t,s,n=1e4){const i=`${(0,c.getBaseUrl)()}${t}`,o=`${e}:${t}`,r=this.inflightRequests.get(o);if(r)try{r.abort()}catch{}const a=new AbortController;this.inflightRequests.set(o,a);try{return await this._doRequest(e,i,s,n)}finally{this.inflightRequests.delete(o)}}_doRequest(e,t,s,n){return new Promise((i,o)=>{const r=new URL(t),c={hostname:r.hostname,port:r.port,path:r.pathname+r.search,method:e,headers:{"Content-Type":"application/json"},timeout:n},l=a.request(c,e=>{let t="";e.on("data",e=>{t+=e.toString()}),e.on("end",()=>{try{const s=JSON.parse(t);e.statusCode&&e.statusCode>=400?o(new Error(s.detail||`HTTP ${e.statusCode}`)):i(s)}catch{o(new Error(`Invalid JSON response: ${t.substring(0,200)}`))}})});l.on("error",e=>o(e)),l.on("timeout",()=>{l.destroy(),o(new Error("Request timeout"))}),s&&l.write(JSON.stringify(s)),l.end()})}async get(e){return this.request("GET",e)}async post(e,t){return this.request("POST",e,t)}async del(e){return this.request("DELETE",e)}async checkHealth(){try{return await this.get("/health")}catch{return null}}async isRunning(){const e=await this.checkHealth();return null!==e&&"healthy"===e.status}async registerWorkspace(e,t){return this.post("/workspace/register",{path:e,name:t})}async listWorkspaces(){return this.get("/workspaces")}async unregisterWorkspace(e){return this.del(`/workspace/${e}`)}async parseError(e,t){return this.post("/error/parse",{error_text:e,workspace_path:t})}async findSimilarErrors(e){return this.post("/error/find-similar",{error_text:e})}async buildContext(e,t,s,n){return this.post("/context/build",{workspace_path:e,task:t,current_file:s,error_text:n})}async buildDebugContext(e,t){return this.post("/context/debug",{error_text:e,workspace_path:t})}async updateSession(e,t,s,n){return this.post("/session/update",{workspace_path:e,current_file:t,terminal_output:s,git_branch:n})}async analyzeGitDiff(e){return this.post("/git/diff",{workspace_path:e})}async getRecentCommits(e,t){const s=t?`?limit=${t}`:"";return this.get(`/git/recent-commits/${encodeURIComponent(e)}${s}`)}async analyzeChangeRisk(e,t){return this.post("/git/analyze-change",{workspace_path:e,file_path:t})}async correlateRootCause(e,t){return this.post("/git/correlate",{workspace_path:e,error_text:t})}async scanSecurity(e){return this.post("/security/scan",{file_path:e})}async scanWorkspaceSecurity(e){return this.post("/security/scan-workspace",{workspace_path:e})}async trackBehavior(e,t,s){return this.post("/behavior/track",{workspace_path:e,event:t,data:s})}async optimizePrompt(e,t,s,n){return this.post("/prompt/optimize",{workspace_path:e,task:t,current_file:s,error_text:n})}async detectEndpoints(e){return this.post("/api/detect",{workspace_path:e})}async validateApiCall(e,t,s){return this.post("/api/validate",{workspace_path:e,method:t,route:s})}async analyzeSQL(e,t){return this.post("/sql/analyze",{query:e,workspace_path:t})}async analyzePrisma(e){return this.post("/prisma/analyze",{workspace_path:e})}async validatePrisma(e){return this.post("/prisma/validate",{workspace_path:e})}async parsePrismaSchema(e){return this.post("/prisma/schema",{schema_path:e})}async validateDTO(e,t){return this.post("/prisma/validate-dto",{workspace_path:e,dto_path:t})}async checkPrismaInclude(e,t){return this.post("/prisma/check-include",{workspace_path:e,file_path:t})}async analyzeContracts(e){return this.post("/contracts/analyze",{workspace_path:e})}async validateContracts(e){return this.post("/contracts/validate",{workspace_path:e})}async checkContract(e,t,s){return this.post("/contracts/check",{method:e,path:t,workspace_path:s})}async getContractMap(e){return this.post("/contracts/map",{workspace_path:e})}async buildDependencyGraph(e){return this.post("/impact/build-graph",{workspace_path:e})}async analyzeImpact(e,t,s,n){return this.post("/impact/analyze",{workspace_path:e,file_path:t,old_content:s,new_content:n})}async analyzeMultiImpact(e,t){return this.post("/impact/analyze-multi",{workspace_path:e,file_paths:t})}async getFileInfo(e,t){return this.post("/impact/file-info",{workspace_path:e,file_path:t})}async getDependencyMap(e){return this.post("/impact/dependency-map",{workspace_path:e})}async fullScan(e){return this.post("/pipeline/full-scan",{workspace_path:e})}async fileChangeScan(e,t,s){return this.post("/pipeline/file-change",{workspace_path:e,file_path:t,content:s})}async preCommitValidation(e,t){return this.post("/pipeline/pre-commit",{workspace_path:e,changed_files:t})}async detectStack(e){return this.post("/stack/detect",{workspace_path:e})}connectWebSocket(e){if(this.ws)try{this.ws.close()}catch{}const t=`${(0,c.getWsUrl)()}/ws/${encodeURIComponent(e)}`;this.output.info(`Connecting WebSocket: ${t}`);try{const n=s(699);this.ws=new n(t),this.ws.on("open",()=>{this.connected=!0,this.output.success("WebSocket connected"),this.emit("connected",{})}),this.ws.on("message",e=>{try{const t=JSON.parse(e.toString());this.emit(t.type,t.data||t)}catch{}}),this.ws.on("close",()=>{this.connected=!1,this.output.warn("WebSocket disconnected"),this.emit("disconnected",{}),this.scheduleReconnect(e)}),this.ws.on("error",e=>{this.output.error(`WebSocket error: ${e.message}`)})}catch(t){this.output.error(`WebSocket connection failed: ${t.message}`),this.scheduleReconnect(e)}}scheduleReconnect(e){this.reconnectTimer||(this.reconnectTimer=setTimeout(()=>{this.reconnectTimer=null,this.connectWebSocket(e)},5e3))}sendWs(e,t){this.ws&&this.connected&&this.ws.send(JSON.stringify({type:e,...t}))}on(e,t){this.wsCallbacks.has(e)||this.wsCallbacks.set(e,[]),this.wsCallbacks.get(e).push(t)}emit(e,t){const s=this.wsCallbacks.get(e)||[];for(const e of s)try{e(t)}catch{}}isConnected(){return this.connected}disconnect(){if(this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.ws){try{this.ws.close()}catch{}this.ws=null}this.connected=!1}}},188(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.EventStream=void 0;const a=r(s(398)),c=["node_modules",".git","__pycache__",".next","dist","build",".venv","venv",".turbo",".cache"],l=new Set([".py",".ts",".tsx",".js",".jsx",".prisma",".json",".toml",".yaml",".yml",".sql",".graphql",".gql",".env"]);t.EventStream=class{constructor(e){this.disposables=[],this.callbacks=[],this.workspacePath="",this.gitBranch="",this.branchPollTimer=null,this.running=!1,this.eventCount=0,this.output=e}start(e){if(this.running)return;this.running=!0,this.workspacePath=e,this.disposables.push(a.workspace.onDidSaveTextDocument(e=>{this.emit(e.uri.fsPath,"saved")}));const t=a.workspace.createFileSystemWatcher("**/*");this.disposables.push(t.onDidCreate(e=>this.emit(e.fsPath,"created")),t.onDidDelete(e=>this.emit(e.fsPath,"deleted")),t),this.disposables.push(a.window.onDidChangeActiveTextEditor(e=>{"file"===e?.document.uri.scheme&&this.emit(e.document.uri.fsPath,"opened")})),this.pollGitBranch(),this.branchPollTimer=setInterval(()=>this.pollGitBranch(),15e3),this.output.info("[EventStream] Started - capturing file events")}stop(){this.running=!1;for(const e of this.disposables)try{e.dispose()}catch{}this.disposables=[],this.branchPollTimer&&(clearInterval(this.branchPollTimer),this.branchPollTimer=null)}onEvent(e){this.callbacks.push(e)}getStats(){return{running:this.running,eventCount:this.eventCount,gitBranch:this.gitBranch}}emit(e,t){const s=e.substring(e.lastIndexOf(".")).toLowerCase();if(!l.has(s))return;const n=e.replace(/\\/g,"/");for(const e of c)if(n.includes(`/${e}/`)||n.includes(`\\${e}\\`))return;const i={file_path:e,change_type:t,workspace_path:this.workspacePath,timestamp:Date.now(),git_branch:this.gitBranch,metadata:{}};this.eventCount++;for(const e of this.callbacks)try{e(i)}catch(e){this.output.warn(`[EventStream] Callback error: ${e}`)}}async pollGitBranch(){try{const e=a.extensions.getExtension("vscode.git")?.exports,t=e?.getAPI(1);if(t?.repositories?.length){const e=t.repositories[0],s=e.state?.HEAD?.name||"";s!==this.gitBranch&&(this.gitBranch=s)}}catch{}}dispose(){this.stop()}}},265(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.activate=async function(e){x=new l.OutputManager,k=new c.EngineClient(x),S=new h.StatusBarManager,M=new _.BackendManager(e,x),e.subscriptions.push(S),M.onProgress(e=>{if(e.includes("Scanning:")){const t=e.match(/(\d+)\/(\d+)/);t&&S.setStatus("connecting",`Scanning ${t[1]}/${t[2]} files`)}else e.includes("Step ")?S.setStatus("connecting",e.replace(/[^\x00-\x7F]/g,"").trim()):e.includes("Waiting")&&S.setStatus("connecting","Starting backend...")}),x.section("COPILOT ENGINE"),x.info("Initializing..."),C=new d.TerminalCapture(k,x,S),E=new u.CopilotCodeLensProvider(k,x),P=new p.SecurityDiagnosticsProvider(k,x),T=new f.GitIntegration(k,x),O=new g.PromptInjector(k,x),$=new m.BehaviorTracker(k,x,S),D=new w.AutonomousEngine(k,x),I=new y.PreCommitInterceptor(k,x),(0,b.registerCommands)(e,k,x,S,O,P,$,T,C,D,M),(0,u.registerCodeLensCommands)(e,k,x);const t=["python","javascript","typescript","javascriptreact","typescriptreact","java","go","rust"];for(const s of t)e.subscriptions.push(a.languages.registerCodeLensProvider({language:s,scheme:"file"},E));e.subscriptions.push({dispose:()=>C.stop()},{dispose:()=>P.dispose()},{dispose:()=>T.dispose()},{dispose:()=>$.dispose()},{dispose:()=>D.dispose()},{dispose:()=>I.dispose()},{dispose:()=>k.disconnect()}),k.on("connected",()=>{S.setStatus("connected")}),k.on("disconnected",()=>{$.isFocusModeActive()||S.setStatus("disconnected")}),k.on("error",e=>{x.warn(`Engine event: ${JSON.stringify(e)}`)}),k.on("file_changed",e=>{E.refresh()}),e.subscriptions.push(a.workspace.onDidSaveTextDocument(e=>{O.scheduleAutoInject(e)})),e.subscriptions.push(a.workspace.onDidChangeConfiguration(e=>{e.affectsConfiguration("copilotEngine")&&((0,v.getConfig)().terminalCapture?C.start():C.stop(),E.refresh(),x.info("Configuration updated"))})),x.success("Copilot Engine extension activated!"),x.info('Use Ctrl+Shift+P â†’ "Copilot Engine" to see available commands');const s=(0,v.getConfig)();if(s.autoStart)if(x.info("Auto-starting backend server..."),S.setStatus("connecting"),await M.start()){S.setStatus("connected"),x.success("Backend auto-started successfully!");const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(e)try{await k.registerWorkspace(e,a.workspace.name),k.connectWebSocket(e)}catch{}s.terminalCapture&&C.start(),s.securityWarnings&&P.start(),$.start(),await T.initialize(),e&&(D.start(e),I.start(e))}else S.setStatus("disconnected"),x.warn("Backend failed to start. Use dashboard to manage backend.");else if(await k.isRunning()){S.setStatus("connected"),x.info("Backend is already running");const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(e){try{await k.registerWorkspace(e,a.workspace.name),k.connectWebSocket(e)}catch{}const t=(0,v.getConfig)();t.terminalCapture&&C.start(),t.securityWarnings&&P.start(),$.start(),await T.initialize(),D.start(e),I.start(e)}}else S.setStatus("disconnected"),x.info('Backend not running. Use dashboard or "Start Engine" command.')},t.deactivate=function(){k?.disconnect(),C?.stop(),P?.dispose(),T?.dispose(),$?.dispose(),D?.dispose(),I?.dispose(),M?.dispose()};const a=r(s(398)),c=s(619),l=s(268),h=s(751),d=s(954),u=s(718),p=s(378),f=s(956),g=s(656),m=s(270),b=s(916),v=s(28),w=s(624),y=s(301),_=s(717);let k,x,S,C,E,P,T,O,$,D,I,M},956(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.GitIntegration=void 0;const a=r(s(398));t.GitIntegration=class{constructor(e,t){this.gitApi=null,this.disposables=[],this.changeWarnTimer=null,this.client=e,this.output=t}async initialize(){try{const e=a.extensions.getExtension("vscode.git");if(!e)return this.output.warn("Git extension not found"),!1;e.isActive||await e.activate();const t=e.exports.getAPI(1);this.gitApi=t;const s=a.workspace.onDidSaveTextDocument(e=>{this.onFileSaved(e)});return this.disposables.push(s),this.output.success("Git integration initialized"),!0}catch(e){return this.output.error(`Git init failed: ${e.message}`),!1}}getCurrentBranch(){if(this.gitApi&&0!==this.gitApi.repositories.length)return this.gitApi.repositories[0].state.HEAD?.name}getCurrentCommit(){if(this.gitApi&&0!==this.gitApi.repositories.length)return this.gitApi.repositories[0].state.HEAD?.commit}getModifiedFiles(){if(!this.gitApi||0===this.gitApi.repositories.length)return[];const e=this.gitApi.repositories[0];return[...e.state.workingTreeChanges.map(e=>e.uri.fsPath),...e.state.indexChanges.map(e=>e.uri.fsPath)]}async getRecentCommits(e=10){if(!this.gitApi||0===this.gitApi.repositories.length)return[];try{return await this.gitApi.repositories[0].log({maxEntries:e})}catch{return[]}}async getDiff(e){if(!this.gitApi||0===this.gitApi.repositories.length)return"";try{return await this.gitApi.repositories[0].diffWithHEAD(e)}catch{return""}}async onFileSaved(e){this.changeWarnTimer&&clearTimeout(this.changeWarnTimer),this.changeWarnTimer=setTimeout(async()=>{try{const t=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(!t)return;const s=await this.client.analyzeChangeRisk(t,e.uri.fsPath);s&&"high"===s.risk_level&&"View Details"===await a.window.showWarningMessage(`âš ï¸ High-risk change detected in ${e.fileName.split(/[/\\]/).pop()}`,"View Details","Dismiss")&&(this.output.show(),this.output.section("CHANGE RISK ANALYSIS"),this.output.warn(`File: ${e.uri.fsPath}`),this.output.warn(`Risk: ${s.risk_level}`),s.warnings&&s.warnings.forEach(e=>this.output.warn(`  â†’ ${e}`))),await this.client.updateSession(t,e.uri.fsPath,void 0,this.getCurrentBranch())}catch{}},2e3)}async correlateErrorWithChanges(e){const t=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(t){this.output.section("ROOT CAUSE ANALYSIS"),this.output.info("Correlating error with recent changes...");try{const s=await this.client.correlateRootCause(t,e);s.likely_cause?(this.output.warn(`Likely cause: ${s.likely_cause}`),this.output.info(`Changed file: ${s.changed_file}`),this.output.info(`Time ago: ${s.time_ago}`),s.commit&&this.output.info(`Commit: ${s.commit.hash} - ${s.commit.message}`),a.window.showWarningMessage(`ðŸ” Likely caused by change in ${s.changed_file} (${s.time_ago})`,"View Details","Open File").then(async e=>{if("View Details"===e)this.output.show();else if("Open File"===e&&s.changed_file){const e=await a.workspace.openTextDocument(s.changed_file);await a.window.showTextDocument(e)}})):this.output.info("No clear root cause found from recent changes")}catch(e){this.output.error(`Correlation failed: ${e.message}`)}}}dispose(){this.changeWarnTimer&&clearTimeout(this.changeWarnTimer);for(const e of this.disposables)e.dispose()}}},268(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.OutputManager=void 0;const a=r(s(398));t.OutputManager=class{constructor(){this.outputChannel=a.window.createOutputChannel("Copilot Engine")}info(e){const t=(new Date).toLocaleTimeString();this.outputChannel.appendLine(`[${t}] â„¹ï¸  ${e}`)}warn(e){const t=(new Date).toLocaleTimeString();this.outputChannel.appendLine(`[${t}] âš ï¸  ${e}`)}error(e){const t=(new Date).toLocaleTimeString();this.outputChannel.appendLine(`[${t}] âŒ ${e}`)}success(e){const t=(new Date).toLocaleTimeString();this.outputChannel.appendLine(`[${t}] âœ… ${e}`)}separator(){this.outputChannel.appendLine("â”€".repeat(60))}section(e){this.separator(),this.outputChannel.appendLine(`  ${e}`),this.separator()}json(e,t){this.outputChannel.appendLine(`${e}:`),this.outputChannel.appendLine(JSON.stringify(t,null,2))}show(){this.outputChannel.show(!0)}clear(){this.outputChannel.clear()}dispose(){this.outputChannel.dispose()}}},301(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.PreCommitInterceptor=void 0;const a=r(s(398));t.PreCommitInterceptor=class{constructor(e,t){this.disposables=[],this.enabled=!0,this.running=!1,this.lastCheckResult=null,this.interceptCount=0,this.blockedCount=0,this.client=e,this.output=t}start(e){this.running||(this.running=!0,this.watchGitCommits(e),this.output.info("[PreCommit] Interceptor active â€” commits will be validated"))}async checkBeforeCommit(e){this.interceptCount++;try{const t=await this.getGitChangedFiles(e);if(0===t.length)return null;this.output.info(`[PreCommit] Validating ${t.length} changed files...`);const s=await this.client.post("/pipeline/pre-commit",{workspace_path:e,changed_files:t});return this.lastCheckResult=s,s.commit_safe?s.commit_warnings?.length&&this.showInfoWarnings(s):(this.blockedCount++,await this.showBlockingWarning(s)),s}catch(e){return this.output.warn(`[PreCommit] Check failed: ${e}`),null}}toggle(){return this.enabled=!this.enabled,this.output.info("[PreCommit] "+(this.enabled?"Enabled":"Disabled")),this.enabled}getStats(){return{enabled:this.enabled,running:this.running,interceptCount:this.interceptCount,blockedCount:this.blockedCount,lastResult:this.lastCheckResult?{risk_score:this.lastCheckResult.risk_score,risk_level:this.lastCheckResult.risk_level,commit_safe:this.lastCheckResult.commit_safe,issues:this.lastCheckResult.issues?.length||0}:null}}watchGitCommits(e){const t=a.Uri.file(s(928).join(e,".git"));try{const s=new a.RelativePattern(t,"COMMIT_EDITMSG"),n=a.workspace.createFileSystemWatcher(s);this.disposables.push(n.onDidCreate(()=>{this.enabled&&this.checkBeforeCommit(e)}),n.onDidChange(()=>{this.enabled&&this.checkBeforeCommit(e)}),n)}catch{this.output.warn("[PreCommit] Could not watch .git directory")}}async getGitChangedFiles(e){try{const e=a.extensions.getExtension("vscode.git")?.exports,t=e?.getAPI(1);if(!t?.repositories?.length)return[];const s=t.repositories[0],n=[...s.state.workingTreeChanges,...s.state.indexChanges].map(e=>e.uri?.fsPath).filter(e=>!!e);return[...new Set(n)]}catch{return[]}}async showBlockingWarning(e){const t=`Commit blocked: ${e.issues.filter(e=>"CRITICAL"===e.severity).length} critical, ${e.issues.filter(e=>"HIGH"===e.severity).length} high severity issues (risk: ${e.risk_score}/10)`;if("Show Details"===await a.window.showWarningMessage(t,{modal:!1},"Show Details","Commit Anyway")){this.output.section("PRE-COMMIT VIOLATIONS");for(const t of e.issues){const e=t.file?` [${t.file}:${t.line||"?"}]`:"";this.output.warn(`[${t.severity}] ${t.category}${e}: ${t.message}`)}this.output.show()}}showInfoWarnings(e){const t=e.commit_warnings||[];t.length&&a.window.showInformationMessage(`Commit OK with ${t.length} warning(s): ${t[0]}`)}stop(){this.running=!1;for(const e of this.disposables)try{e.dispose()}catch{}this.disposables=[]}dispose(){this.stop()}}},656(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.PromptInjector=void 0;const a=r(s(398)),c=s(28),l="@copilot-engine-context-start",h="@copilot-engine-context-end",d={python:{line:"#",blockStart:'"""',blockEnd:'"""'},javascript:{line:"//",blockStart:"/*",blockEnd:"*/"},typescript:{line:"//",blockStart:"/*",blockEnd:"*/"},javascriptreact:{line:"//",blockStart:"/*",blockEnd:"*/"},typescriptreact:{line:"//",blockStart:"/*",blockEnd:"*/"},java:{line:"//",blockStart:"/*",blockEnd:"*/"},go:{line:"//",blockStart:"/*",blockEnd:"*/"},rust:{line:"//",blockStart:"/*",blockEnd:"*/"},c:{line:"//",blockStart:"/*",blockEnd:"*/"},cpp:{line:"//",blockStart:"/*",blockEnd:"*/"},html:{line:"",blockStart:"\x3c!--",blockEnd:"--\x3e"},css:{line:"",blockStart:"/*",blockEnd:"*/"},prisma:{line:"//",blockStart:"//",blockEnd:"//"}};t.PromptInjector=class{constructor(e,t){this.debounceTimer=null,this.lastInjectionHash="",this.injecting=!1,this.client=e,this.output=t}async injectContextAtCursor(){const e=a.window.activeTextEditor;if(!e)return void a.window.showWarningMessage("No active editor");const t=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(!t)return;const s=e.document,n=e.selection,i=s.getText(n);let o="Help with this code";i&&(o=`Analyze and improve this selected code:\n\n${i}`);try{const[i,r]=await Promise.allSettled([this.client.optimizePrompt(t,o,s.uri.fsPath),this.client.fileChangeScan(t,s.uri.fsPath)]),c="fulfilled"===i.status?i.value:null,l="fulfilled"===r.status?r.value:null,h=this.buildContextBlock(s.languageId,c,l);await this.removeExistingBlock(e);const d=n.start.line,u=new a.Position(d,0);await e.edit(e=>{e.insert(u,h+"\n")}),a.window.showInformationMessage("Context injected! Copilot will use it for suggestions.","Remove Later").then(t=>{"Remove Later"===t&&this.removeExistingBlock(e)})}catch(e){this.output.error(`Context injection failed: ${e.message}`),a.window.showErrorMessage("Failed to inject context")}}async injectDebugContext(e){const t=a.window.activeTextEditor,s=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(s)try{const n=await this.client.buildDebugContext(e,s);if(t){const s=this.buildDebugBlock(t.document.languageId,n,e);await this.removeExistingBlock(t);const i=new a.Position(t.selection.start.line,0);await t.edit(e=>{e.insert(i,s+"\n")})}await a.env.clipboard.writeText(n.prompt),a.window.showInformationMessage("Debug context injected and copied to clipboard!")}catch(e){this.output.error(`Debug context failed: ${e.message}`)}}scheduleAutoInject(e){(0,c.getConfig)().autoInjectContext&&d[e.languageId]&&(this.debounceTimer&&clearTimeout(this.debounceTimer),this.debounceTimer=setTimeout(async()=>{this.debounceTimer=null,await this.autoInjectForFile(e)},2e3))}async buildTaskContext(e){const t=a.workspace.workspaceFolders?.[0]?.uri.fsPath,s=a.window.activeTextEditor?.document.uri.fsPath;if(!t)return null;try{return(await this.client.optimizePrompt(t,e,s)).prompt}catch{return null}}async removeContextBlock(){const e=a.window.activeTextEditor;e&&(await this.removeExistingBlock(e)?a.window.showInformationMessage("Context block removed"):a.window.showInformationMessage("No context block found"))}async autoInjectForFile(e){if(!this.injecting){this.injecting=!0;try{const t=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(!t)return;const s=await this.client.fileChangeScan(t,e.uri.fsPath);if(!s.issues||0===s.issues.length)return;const n=this.hashIssues(s.issues);if(n===this.lastInjectionHash)return;this.lastInjectionHash=n;const i=a.window.visibleTextEditors.find(t=>t.document.uri.toString()===e.uri.toString());if(!i)return;const o=this.buildEnforcementOnlyBlock(e.languageId,s);await this.removeExistingBlock(i),await i.edit(e=>{e.insert(new a.Position(0,0),o+"\n")})}catch{}finally{this.injecting=!1}}}buildContextBlock(e,t,s){const n=(d[e]||d.javascript).line,i=[];if(i.push(`${n} ${l}`),i.push(`${n} â•â•â• Copilot Engine Context â•â•â•`),t){const e=t.metadata;e.project&&i.push(`${n}  Project: ${e.project}`),e.current_file&&i.push(`${n}  File: ${e.current_file}`),e.has_error&&i.push(`${n}  Status: DEBUGGING ERROR`),i.push(`${n}  Tokens: ${t.token_estimate}`),e.task&&i.push(`${n}  Task: ${e.task}`)}if(s&&s.issues&&s.issues.length>0){i.push(`${n}`),i.push(`${n} â”€â”€â”€ Enforcement (${s.issues.length} issues) â”€â”€â”€`),i.push(`${n}  Risk: ${s.risk_score?.toFixed(2)||"N/A"}`),void 0!==s.commit_safe&&i.push(`${n}  Commit Safe: ${s.commit_safe?"YES":"NO"}`);const e=s.issues.filter(e=>"critical"===e.severity||"error"===e.severity),t=s.issues.filter(e=>"warning"===e.severity);if(e.length>0){i.push(`${n}  CRITICAL:`);for(const t of e.slice(0,5))i.push(`${n}    ! ${t.category}: ${t.message}`)}if(t.length>0){i.push(`${n}  WARNINGS:`);for(const e of t.slice(0,5))i.push(`${n}    ~ ${e.category}: ${e.message}`)}}else s&&i.push(`${n}  Enforcement: All checks passed`);return i.push(`${n} ${h}`),i.join("\n")}buildEnforcementOnlyBlock(e,t){const s=(d[e]||d.javascript).line,n=[];n.push(`${s} ${l}`),n.push(`${s} â•â•â• Copilot Engine: Enforcement â•â•â•`),n.push(`${s}  Risk: ${t.risk_score?.toFixed(2)||"0.00"} | Issues: ${t.issues.length}`),void 0!==t.commit_safe&&n.push(`${s}  Commit: ${t.commit_safe?"SAFE":"BLOCKED"}`);for(const e of t.issues.slice(0,8)){const t="critical"===e.severity||"error"===e.severity?"!":"warning"===e.severity?"~":"-";n.push(`${s}  ${t} [${e.category}] ${e.message}`)}return t.issues.length>8&&n.push(`${s}  ... and ${t.issues.length-8} more`),n.push(`${s} ${h}`),n.join("\n")}buildDebugBlock(e,t,s){const n=(d[e]||d.javascript).line,i=[];i.push(`${n} ${l}`),i.push(`${n} â•â•â• Copilot Engine: Debug Context â•â•â•`);const o=s.split("\n")[0].substring(0,100);i.push(`${n}  Error: ${o}`);const r=t.metadata;return r.project&&i.push(`${n}  Project: ${r.project}`),r.has_error&&i.push(`${n}  Status: Active error`),i.push(`${n}  Tokens: ${t.token_estimate}`),i.push(`${n} ${h}`),i.join("\n")}async removeExistingBlock(e){const t=e.document,s=t.getText(),n=s.indexOf(l);if(-1===n)return!1;const i=s.indexOf(h,n);if(-1===i)return!1;const o=t.positionAt(n),r=t.positionAt(i+27),c=o.line;let d=r.line+1;d>t.lineCount&&(d=t.lineCount);const u=t.lineAt(c).range.start;let p;p=d<t.lineCount?t.lineAt(d).range.start:t.lineAt(t.lineCount-1).range.end;const f=new a.Range(u,p);return await e.edit(e=>{e.delete(f)}),!0}hashIssues(e){const t=e.map(e=>`${e.severity}:${e.category}:${e.message}`).sort().join("|");let s=0;for(let e=0;e<t.length;e++)s=(s<<5)-s+t.charCodeAt(e),s|=0;return s.toString(36)}}},378(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.SecurityDiagnosticsProvider=void 0;const a=r(s(398)),c=s(28),l=[{pattern:/\beval\s*\(/,severity:a.DiagnosticSeverity.Error,message:"Use of eval() is a security risk",suggestion:"Use JSON.parse() or safer alternatives"},{pattern:/\bexec\s*\(/,severity:a.DiagnosticSeverity.Warning,message:"Use of exec() can be dangerous",suggestion:"Use subprocess with shell=False"},{pattern:/f["'].*SELECT.*\{/,severity:a.DiagnosticSeverity.Error,message:"Potential SQL injection via f-string",suggestion:"Use parameterized queries"},{pattern:/["'].*SELECT.*["']\s*\+/,severity:a.DiagnosticSeverity.Error,message:"Potential SQL injection via string concatenation",suggestion:"Use parameterized queries"},{pattern:/\.format\(.*SELECT/i,severity:a.DiagnosticSeverity.Error,message:"Potential SQL injection via .format()",suggestion:"Use parameterized queries"},{pattern:/`.*SELECT.*\$\{/,severity:a.DiagnosticSeverity.Error,message:"Potential SQL injection via template literal",suggestion:"Use parameterized queries"},{pattern:/(?:password|passwd|secret|api_key|apikey|token|auth)\s*=\s*["'][^"']{8,}["']/i,severity:a.DiagnosticSeverity.Error,message:"Possible hardcoded secret detected",suggestion:"Use environment variables or a secrets manager"},{pattern:/(?:AWS_SECRET|PRIVATE_KEY)\s*=\s*["']/i,severity:a.DiagnosticSeverity.Error,message:"Hardcoded cloud credential",suggestion:"Use environment variables"},{pattern:/jwt\.decode\(.*verify\s*=\s*False/i,severity:a.DiagnosticSeverity.Error,message:"JWT decoded without verification",suggestion:"Set verify=True"},{pattern:/jsonwebtoken.*verify.*algorithms.*none/i,severity:a.DiagnosticSeverity.Error,message:'JWT with "none" algorithm allowed',suggestion:"Specify allowed algorithms explicitly"},{pattern:/Access-Control-Allow-Origin.*\*/,severity:a.DiagnosticSeverity.Warning,message:"CORS allows all origins",suggestion:"Restrict to specific origins"},{pattern:/allow_origins\s*=\s*\[["']\*["']\]/,severity:a.DiagnosticSeverity.Warning,message:"CORS allows all origins",suggestion:"Restrict to specific domains"},{pattern:/\bmd5\b/i,severity:a.DiagnosticSeverity.Warning,message:"MD5 is cryptographically weak",suggestion:"Use SHA-256 or bcrypt for passwords"},{pattern:/\bsha1\b/i,severity:a.DiagnosticSeverity.Warning,message:"SHA-1 is cryptographically weak",suggestion:"Use SHA-256 or SHA-3"},{pattern:/console\.log\(.*password/i,severity:a.DiagnosticSeverity.Error,message:"Password may be logged to console",suggestion:"Remove sensitive data from logs"},{pattern:/print\(.*password/i,severity:a.DiagnosticSeverity.Warning,message:"Password may be printed",suggestion:"Remove sensitive data from output"},{pattern:/DEBUG\s*=\s*True/,severity:a.DiagnosticSeverity.Warning,message:"Debug mode enabled",suggestion:"Disable debug mode in production"},{pattern:/pickle\.loads?\(/,severity:a.DiagnosticSeverity.Error,message:"Pickle deserialization is unsafe with untrusted data",suggestion:"Use JSON or a safe serialization format"},{pattern:/yaml\.load\((?!.*Loader)/,severity:a.DiagnosticSeverity.Warning,message:"yaml.load() without Loader is unsafe",suggestion:"Use yaml.safe_load()"}];t.SecurityDiagnosticsProvider=class{constructor(e,t){this.disposables=[],this.client=e,this.output=t,this.diagnosticCollection=a.languages.createDiagnosticCollection("copilot-engine-security")}start(){if(!(0,c.getConfig)().securityWarnings)return;const e=a.workspace.onDidOpenTextDocument(e=>{this.scanDocument(e)});this.disposables.push(e);const t=a.workspace.onDidSaveTextDocument(e=>{this.scanDocument(e)});this.disposables.push(t);let s=null;const n=a.workspace.onDidChangeTextDocument(e=>{s&&clearTimeout(s),s=setTimeout(()=>{this.scanDocument(e.document)},1500)});this.disposables.push(n),a.workspace.textDocuments.forEach(e=>this.scanDocument(e)),this.output.success("Security diagnostics started")}scanDocument(e){if(!["python","javascript","typescript","javascriptreact","typescriptreact","java","go","rust","ruby","php"].includes(e.languageId))return;const t=e.uri.fsPath;if(t.includes("node_modules")||t.includes("site-packages")||t.includes(".venv")||t.includes("__pycache__"))return;const s=[],n=e.getText().split("\n");for(let t=0;t<n.length;t++){const i=n[t],o=i.trim();if(!(o.startsWith("#")||o.startsWith("//")||o.startsWith("*")||o.startsWith("/*")))for(const n of l)if(n.pattern.test(i)){const o=i.match(n.pattern),r=o?i.indexOf(o[0]):0,c=o?r+o[0].length:i.length,l=new a.Range(t,r,t,c),h=new a.Diagnostic(l,n.message,n.severity);h.source="Copilot Engine",h.code={value:"security",target:a.Uri.parse("https://owasp.org/www-project-top-ten/")},h.relatedInformation=[new a.DiagnosticRelatedInformation(new a.Location(e.uri,l),`Fix: ${n.suggestion}`)],s.push(h)}}this.diagnosticCollection.set(e.uri,s)}async scanWorkspace(){const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(e){this.output.section("WORKSPACE SECURITY SCAN"),this.output.info("Scanning all files...");try{const t=await this.client.scanWorkspaceSecurity(e);if(t.findings&&t.findings.length>0){this.output.warn(`Found ${t.findings.length} security issues:`);for(const e of t.findings)this.output.warn(`  [${e.severity}] ${e.file}:${e.line} - ${e.issue}`)}else this.output.success("No security issues found!")}catch(e){this.output.info("Running local pattern scan...");let t=0;for(const e of a.workspace.textDocuments){this.scanDocument(e);const s=this.diagnosticCollection.get(e.uri);s&&(t+=s.length)}this.output.info(`Found ${t} issues in open files`)}}}clearDiagnostics(){this.diagnosticCollection.clear()}dispose(){this.diagnosticCollection.dispose();for(const e of this.disposables)e.dispose()}}},751(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.StatusBarManager=void 0;const a=r(s(398));t.StatusBarManager=class{constructor(){this.currentStatus="disconnected",this.statusBarItem=a.window.createStatusBarItem(a.StatusBarAlignment.Left,100),this.statusBarItem.command="copilotEngine.showStatus",this.setStatus("disconnected"),this.statusBarItem.show()}setStatus(e,t){switch(this.currentStatus=e,e){case"disconnected":this.statusBarItem.text="$(circle-slash) Engine Off",this.statusBarItem.backgroundColor=void 0,this.statusBarItem.tooltip="Copilot Engine: Disconnected. Click to start.";break;case"connecting":this.statusBarItem.text="$(sync~spin) Engine...",this.statusBarItem.backgroundColor=void 0,this.statusBarItem.tooltip="Copilot Engine: Connecting...";break;case"connected":this.statusBarItem.text="$(zap) Engine",this.statusBarItem.backgroundColor=void 0,this.statusBarItem.tooltip="Copilot Engine: Connected"+(t?" - "+t:"");break;case"error":this.statusBarItem.text="$(warning) Engine Error",this.statusBarItem.backgroundColor=new a.ThemeColor("statusBarItem.warningBackground"),this.statusBarItem.tooltip="Copilot Engine: Error"+(t?" - "+t:"");break;case"focus-mode":this.statusBarItem.text="$(flame) Focus Mode",this.statusBarItem.backgroundColor=new a.ThemeColor("statusBarItem.errorBackground"),this.statusBarItem.tooltip="Copilot Engine: Focus Mode Active"}}getStatus(){return this.currentStatus}setErrorCount(e){e>0&&"connected"===this.currentStatus&&(this.statusBarItem.text=`$(zap) Engine (${e} errors)`)}dispose(){this.statusBarItem.dispose()}}},954(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.TerminalCapture=void 0;const a=r(s(398)),c=s(28),l=[{lang:"python",pattern:/Traceback \(most recent call last\):/m},{lang:"python",pattern:/^\w+Error: .+$/m},{lang:"python",pattern:/^\w+Exception: .+$/m},{lang:"python",pattern:/^SyntaxError: /m},{lang:"javascript",pattern:/^\w+Error: .+\n\s+at /m},{lang:"javascript",pattern:/^(TypeError|ReferenceError|SyntaxError|RangeError): /m},{lang:"javascript",pattern:/UnhandledPromiseRejection/m},{lang:"typescript",pattern:/error TS\d+: /m},{lang:"typescript",pattern:/\.tsx?:\d+:\d+/m},{lang:"java",pattern:/Exception in thread "/m},{lang:"java",pattern:/^\w+\.(\w+Exception|\w+Error): .+$/m},{lang:"go",pattern:/^panic: /m},{lang:"go",pattern:/^goroutine \d+ \[/m},{lang:"rust",pattern:/^error\[E\d+\]: /m},{lang:"rust",pattern:/^error: /m},{lang:"generic",pattern:/^FATAL:/m},{lang:"generic",pattern:/^ERROR:/im},{lang:"generic",pattern:/^FAILED/m},{lang:"generic",pattern:/exit code: [1-9]/im}];t.TerminalCapture=class{constructor(e,t,s){this.disposables=[],this.terminalBuffers=new Map,this.debounceTimers=new Map,this.errorHistory=[],this.errorCount=0,this.errorCallbacks=[],this.client=e,this.output=t,this.statusBar=s}start(){if(!(0,c.getConfig)().terminalCapture)return void this.output.info("Terminal capture disabled in settings");try{const e=a.window.onDidEndTerminalShellExecution(async e=>{void 0!==e.exitCode&&0!==e.exitCode&&await this.handleFailedExecution(e)});this.disposables.push(e)}catch{this.output.warn("Terminal shell integration API not available, using fallback")}try{const e=a.window.onDidWriteTerminalData(e=>{this.handleTerminalData(e.terminal,e.data)});this.disposables.push(e)}catch{this.output.warn("onDidWriteTerminalData not available")}const e=a.window.onDidCloseTerminal(e=>{const t=e.name;this.terminalBuffers.delete(t);const s=this.debounceTimers.get(t);s&&(clearTimeout(s),this.debounceTimers.delete(t))});this.disposables.push(e),this.output.success("Terminal capture started")}onError(e){this.errorCallbacks.push(e)}handleTerminalData(e,t){const s=e.name;let n=this.terminalBuffers.get(s)||"";n+=t,n.length>5e3&&(n=n.substring(n.length-5e3)),this.terminalBuffers.set(s,n);const i=this.debounceTimers.get(s);i&&clearTimeout(i),this.debounceTimers.set(s,setTimeout(()=>{this.checkForErrors(s,n),this.debounceTimers.delete(s)},800))}async handleFailedExecution(e){const t=e.execution;try{let e="";if(t&&"function"==typeof t.read){const s=t.read();for await(const t of s)e+=t}e&&this.checkForErrors(`shell-${Date.now()}`,e)}catch{}}async checkForErrors(e,t){let s=null;for(const e of l)if(e.pattern.test(t)){s=e;break}if(!s)return;const n=this.extractErrorBlock(t,s.lang);if(!n||n.length<10)return;const i=n.substring(0,100);if(!this.errorHistory.some(e=>(e.error_type+e.message).substring(0,100)===i)){this.output.section("ERROR DETECTED"),this.output.info(`Language: ${s.lang}`);try{const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath,t=await this.client.parseError(n,e);this.errorHistory.push(t),this.errorHistory.length>50&&this.errorHistory.shift(),this.errorCount++,this.statusBar.setErrorCount(this.errorCount),this.output.info(`Type: ${t.error_type}`),this.output.info(`Message: ${t.message}`),t.file_path&&this.output.info(`File: ${t.file_path}:${t.line_number}`),t.suggestions.length>0&&(this.output.info("Suggestions:"),t.suggestions.forEach(e=>this.output.info(`  â†’ ${e}`)));for(const e of this.errorCallbacks)try{e(t,n)}catch{}this.showErrorNotification(t,n)}catch(e){this.output.error(`Failed to parse error: ${e.message}`)}this.terminalBuffers.set(e,"")}}extractErrorBlock(e,t){const s=e.split("\n");if("python"===t){const e=s.findIndex(e=>e.includes("Traceback (most recent call last):"));if(e>=0){let t=e+1;for(let n=e+1;n<s.length;n++)if(t=n,/^\w+Error:|\w+Exception:/.test(s[n].trim())){t=n+1;break}return s.slice(e,t).join("\n")}const t=s.find(e=>/^\w+(Error|Exception): /.test(e.trim()));if(t)return t.trim()}if("javascript"===t||"typescript"===t){const e=s.findIndex(e=>/^\w+Error: /.test(e.trim()));if(e>=0){let t=e+1;for(let n=e+1;n<s.length&&n<e+20&&s[n].trim().startsWith("at ");n++)t=n+1;return s.slice(e,t).join("\n")}}return s.slice(-30).join("\n")}async showErrorNotification(e,t){if("none"===(0,c.getConfig)().notificationLevel)return;const s=`${e.error_type}: ${e.message.substring(0,80)}`;switch(await a.window.showErrorMessage(`âš¡ ${s}`,"View Suggestions","Build Context","Go to Error","Dismiss")){case"View Suggestions":this.output.show(),this.output.section("SUGGESTIONS"),e.suggestions.forEach(e=>this.output.info(`â†’ ${e}`)),e.related_files.length>0&&(this.output.info("Related files:"),e.related_files.forEach(e=>this.output.info(`  ðŸ“„ ${e}`)));break;case"Build Context":const s=a.workspace.workspaceFolders?.[0]?.uri.fsPath;if(s)try{const e=await this.client.buildDebugContext(t,s);this.output.show(),this.output.section("DEBUG CONTEXT (copy for Copilot)"),this.output.info(e.prompt),this.output.info(`\nToken estimate: ${e.token_estimate}`),await a.env.clipboard.writeText(e.prompt),a.window.showInformationMessage("Debug context copied to clipboard!")}catch(e){this.output.error(`Failed to build context: ${e.message}`)}break;case"Go to Error":if(e.file_path&&e.line_number){const t=await a.workspace.openTextDocument(e.file_path),s=await a.window.showTextDocument(t),n=new a.Position(e.line_number-1,0);s.selection=new a.Selection(n,n),s.revealRange(new a.Range(n,n),a.TextEditorRevealType.InCenter)}}}getErrorHistory(){return[...this.errorHistory]}getErrorCount(){return this.errorCount}clearHistory(){this.errorHistory=[],this.errorCount=0,this.statusBar.setErrorCount(0)}stop(){this.dispose()}dispose(){for(const e of this.disposables)e.dispose();for(const e of this.debounceTimers.values())clearTimeout(e);this.terminalBuffers.clear(),this.debounceTimers.clear()}}},417(e,t,s){var n,i=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s);var i=Object.getOwnPropertyDescriptor(t,s);i&&!("get"in i?!t.__esModule:i.writable||i.configurable)||(i={enumerable:!0,get:function(){return t[s]}}),Object.defineProperty(e,n,i)}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),r=this&&this.__importStar||(n=function(e){return n=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},n(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var s=n(e),r=0;r<s.length;r++)"default"!==s[r]&&i(t,e,s[r]);return o(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.DashboardPanel=void 0;const a=r(s(398));class c{constructor(e,t,s,n){this.disposables=[],this.panel=e,this.client=t,this.autonomousEngine=s,this.backendManager=n,this.panel.webview.html=this.getHtml(),this.panel.onDidDispose(()=>{c.currentPanel=void 0;for(const e of this.disposables)e.dispose()},null,this.disposables),this.panel.webview.onDidReceiveMessage(async e=>{await this.handleMessage(e)},null,this.disposables),this.autonomousEngine.onDashboardUpdate(e=>{this.pushDashboardData(e)});const i=this.autonomousEngine.getLatestDashboard();i&&this.pushDashboardData(i),this.backendManager.onStatusChange(e=>{this.pushBackendStatus(e),"starting"===e.health&&this.panel.webview.postMessage({command:"backendLogs",logs:this.backendManager.getLogs()})})}static show(e,t,s,n){if(c.currentPanel)return void c.currentPanel.panel.reveal();const i=a.window.createWebviewPanel("copilotEngineDashboard","âš¡ Copilot Engine â€” Monitor",a.ViewColumn.One,{enableScripts:!0,retainContextWhenHidden:!0});c.currentPanel=new c(i,t,s,n)}pushDashboardData(e){this.panel.webview.postMessage({command:"dashboard",data:e})}pushBackendStatus(e){this.panel.webview.postMessage({command:"backendStatus",status:e})}async handleMessage(e){switch(e.command){case"openSettings":await a.commands.executeCommand("workbench.action.openSettings","copilotEngine");break;case"webviewReady":{await this.backendManager.detectExisting(),this.pushBackendStatus(this.backendManager.getStatus()),this.panel.webview.postMessage({command:"backendLogs",logs:this.backendManager.getLogs()});const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath;let t=this.autonomousEngine.getLatestDashboard();!t&&e&&(t=await this.autonomousEngine.refreshDashboard(e)),t&&this.pushDashboardData(t);break}case"toggleFocus":await a.commands.executeCommand("copilotEngine.toggleFocusMode");break;case"openFile":if(e.filePath){const t=await a.workspace.openTextDocument(e.filePath);await a.window.showTextDocument(t,{selection:e.line?new a.Range(e.line-1,0,e.line-1,0):void 0})}break;case"startBackend":await this.backendManager.start();break;case"stopBackend":this.backendManager.stop();break;case"restartBackend":await this.backendManager.restart();break;case"refreshBackend":{await this.backendManager.detectExisting(),this.pushBackendStatus(this.backendManager.getStatus()),this.panel.webview.postMessage({command:"backendLogs",logs:this.backendManager.getLogs()});const e=a.workspace.workspaceFolders?.[0]?.uri.fsPath,t=await this.autonomousEngine.refreshDashboard(e);t&&this.pushDashboardData(t);break}case"fullScan":await a.commands.executeCommand("copilotEngine.fullScan");break;case"securityScan":await a.commands.executeCommand("copilotEngine.checkSecurity");break;case"gitAnalysis":await a.commands.executeCommand("copilotEngine.analyzeGitChanges");break;case"preCommit":await a.commands.executeCommand("copilotEngine.preCommitCheck");break;case"validateContracts":await a.commands.executeCommand("copilotEngine.validateContracts");break;case"validateSchema":await a.commands.executeCommand("copilotEngine.validateSchema");break;case"detectStack":await a.commands.executeCommand("copilotEngine.detectStack");break;case"detectEndpoints":await a.commands.executeCommand("copilotEngine.detectEndpoints");break;case"analyzeCode":await a.commands.executeCommand("copilotEngine.analyzeCode");break;case"buildContext":await a.commands.executeCommand("copilotEngine.buildContext");break;case"showOutput":await a.commands.executeCommand("copilotEngine.showStatus")}}getHtml(){return'<!DOCTYPE html>\n<html lang="en">\n<head>\n<meta charset="UTF-8">\n<meta name="viewport" content="width=device-width, initial-scale=1.0">\n<style>\n*{box-sizing:border-box;margin:0;padding:0}\nbody{\n  font-family:var(--vscode-font-family);\n  color:var(--vscode-foreground);\n  background:var(--vscode-editor-background);\n  line-height:1.5;\n  overflow-y:auto;\n}\n::-webkit-scrollbar{width:6px}\n::-webkit-scrollbar-thumb{background:var(--vscode-scrollbarSlider-background);border-radius:3px}\n\n.shell{max-width:1000px;margin:0 auto;padding:24px 20px 60px}\n\n/* â”€â”€ Header â”€â”€ */\n.header{display:flex;align-items:center;justify-content:space-between;margin-bottom:24px;padding-bottom:14px;border-bottom:1px solid var(--vscode-panel-border)}\n.header h1{font-size:20px;font-weight:700;letter-spacing:-.3px}\n.header h1 span{opacity:.4;font-weight:400;font-size:12px;margin-left:6px}\n.header-right{display:flex;align-items:center;gap:10px}\n.pill{display:inline-flex;align-items:center;gap:5px;padding:3px 12px;border-radius:16px;font-size:11px;font-weight:600}\n.pill-dot{width:7px;height:7px;border-radius:50%}\n.pill-healthy{background:#22c55e18;color:#4ade80}.pill-healthy .pill-dot{background:#4ade80;box-shadow:0 0 6px #4ade80}\n.pill-caution{background:#eab30818;color:#facc15}.pill-caution .pill-dot{background:#facc15}\n.pill-atrisk{background:#f9731618;color:#fb923c}.pill-atrisk .pill-dot{background:#fb923c}\n.pill-degraded{background:#ef444418;color:#f87171}.pill-degraded .pill-dot{background:#f87171}\n.pill-critical{background:#dc262618;color:#ef4444}.pill-critical .pill-dot{background:#ef4444;box-shadow:0 0 6px #ef4444}\n\n/* â”€â”€ Health Gauge â”€â”€ */\n.gauge-wrap{display:flex;align-items:center;gap:20px;margin-bottom:24px;padding:20px;background:var(--vscode-editor-inactiveSelectionBackground);border:1px solid var(--vscode-panel-border);border-radius:12px}\n.gauge{width:120px;height:120px;position:relative;flex-shrink:0}\n.gauge svg{width:100%;height:100%;transform:rotate(-90deg)}\n.gauge-bg{fill:none;stroke:var(--vscode-panel-border);stroke-width:8}\n.gauge-fill{fill:none;stroke-width:8;stroke-linecap:round;transition:stroke-dashoffset .8s ease,stroke .5s}\n.gauge-text{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}\n.gauge-score{font-size:28px;font-weight:800;line-height:1}\n.gauge-label{font-size:10px;opacity:.5;text-transform:uppercase;letter-spacing:.5px;margin-top:2px}\n.gauge-info{flex:1}\n.gauge-level{font-size:18px;font-weight:700;margin-bottom:6px}\n.gauge-meta{font-size:12px;opacity:.55;line-height:1.7}\n\n/* â”€â”€ Risk Category Grid â”€â”€ */\n.categories{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:10px;margin-bottom:24px}\n.cat-card{background:var(--vscode-editor-inactiveSelectionBackground);border:1px solid var(--vscode-panel-border);border-radius:10px;padding:12px 14px;text-align:center;transition:border-color .3s}\n.cat-card.warn{border-color:#eab30866}\n.cat-card.danger{border-color:#ef444466}\n.cat-val{font-size:22px;font-weight:700}\n.cat-lbl{font-size:10px;opacity:.5;text-transform:uppercase;letter-spacing:.4px;margin-top:2px}\n.c-green{color:#4ade80}.c-yellow{color:#facc15}.c-orange{color:#fb923c}.c-red{color:#ef4444}\n\n/* â”€â”€ Section â”€â”€ */\n.section{margin-bottom:24px}\n.section-title{font-size:12px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;opacity:.5;margin-bottom:10px;display:flex;align-items:center;gap:8px}\n.section-title::after{content:\'\';flex:1;height:1px;background:var(--vscode-panel-border)}\n.section-title .count{background:var(--vscode-badge-background);color:var(--vscode-badge-foreground);padding:1px 7px;border-radius:10px;font-size:10px;font-weight:700}\n\n/* â”€â”€ Panels â”€â”€ */\n.panel{background:var(--vscode-editor-inactiveSelectionBackground);border:1px solid var(--vscode-panel-border);border-radius:10px;overflow:hidden;max-height:280px;overflow-y:auto}\n.panel-empty{padding:24px;text-align:center;opacity:.4;font-size:12px}\n\n/* â”€â”€ Issue rows â”€â”€ */\n.row{display:flex;align-items:flex-start;gap:8px;padding:8px 14px;border-bottom:1px solid var(--vscode-panel-border);font-size:12px;cursor:pointer;transition:background .1s}\n.row:hover{background:var(--vscode-list-hoverBackground)}\n.row:last-child{border-bottom:none}\n.row-icon{flex-shrink:0;font-size:13px;margin-top:1px}\n.row-body{flex:1;min-width:0}\n.row-msg{font-size:12px}\n.row-meta{font-size:11px;opacity:.45;margin-top:1px}\n.sev-crit{color:#ef4444}.sev-high{color:#fb923c}.sev-med{color:#facc15}.sev-low{color:#4ade80}\n\n/* â”€â”€ Trend sparkline â”€â”€ */\n.trend-wrap{background:var(--vscode-editor-inactiveSelectionBackground);border:1px solid var(--vscode-panel-border);border-radius:10px;padding:14px;height:100px;position:relative;overflow:hidden}\n.trend-label{position:absolute;top:10px;left:14px;font-size:10px;opacity:.4;text-transform:uppercase;letter-spacing:.5px}\n.trend-svg{width:100%;height:100%}\n\n/* â”€â”€ Worker stats bar â”€â”€ */\n.worker-bar{display:flex;gap:14px;flex-wrap:wrap;margin-bottom:24px;font-size:11px;opacity:.55}\n.worker-bar span{display:inline-flex;align-items:center;gap:4px}\n.wdot{width:6px;height:6px;border-radius:50%;background:#4ade80}\n.wdot.off{background:#f87171}\n\n/* â”€â”€ Minimal controls â”€â”€ */\n.controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:24px}\n.cbtn{\n  padding:5px 12px;border-radius:5px;font-size:11px;font-weight:500;\n  border:1px solid var(--vscode-panel-border);\n  background:transparent;color:var(--vscode-foreground);\n  cursor:pointer;transition:all .12s;opacity:.7\n}\n.cbtn:hover{opacity:1;border-color:var(--vscode-focusBorder)}\n\n/* â”€â”€ Quick Actions Grid â”€â”€ */\n.actions-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(140px,1fr));gap:8px;margin-bottom:16px}\n.action-btn{\n  display:flex;align-items:center;gap:8px;padding:10px 14px;border-radius:8px;\n  background:var(--vscode-editor-inactiveSelectionBackground);\n  border:1px solid var(--vscode-panel-border);\n  color:var(--vscode-foreground);cursor:pointer;transition:all .15s;\n  font-size:12px;font-weight:500;text-align:left\n}\n.action-btn:hover{background:var(--vscode-list-hoverBackground);border-color:var(--vscode-focusBorder);transform:translateY(-1px)}\n.action-btn .icon{font-size:16px;flex-shrink:0}\n.action-btn .label{flex:1;line-height:1.3}\n.action-btn .label small{display:block;font-size:10px;opacity:.5;font-weight:400}\n.action-btn.primary{background:var(--vscode-button-background);color:var(--vscode-button-foreground);border-color:var(--vscode-button-background)}\n.action-btn.primary:hover{background:var(--vscode-button-hoverBackground)}\n.action-btn.warning{border-color:#eab308;background:#eab30815}\n.action-btn.danger{border-color:#ef4444;background:#ef444415}\n\n.footer{text-align:center;opacity:.25;font-size:10px;margin-top:28px}\n\n/* â”€â”€ Backend Management â”€â”€ */\n.backend-panel{background:var(--vscode-editor-inactiveSelectionBackground);border:1px solid var(--vscode-panel-border);border-radius:10px;padding:16px;margin-bottom:24px}\n.backend-status{display:flex;align-items:center;justify-content:space-between;gap:16px;margin-bottom:16px;flex-wrap:wrap}\n.backend-indicator{display:flex;align-items:center;gap:12px;flex:1;min-width:220px}\n.status-dot{width:12px;height:12px;border-radius:50%;flex-shrink:0}\n.status-dot.status-stopped{background:#6b7280;box-shadow:0 0 0 2px #6b72804d}\n.status-dot.status-starting{background:#facc15;box-shadow:0 0 8px #facc15;animation:pulse 1.5s ease-in-out infinite}\n.status-dot.status-healthy{background:#4ade80;box-shadow:0 0 8px #4ade80}\n.status-dot.status-unhealthy{background:#ef4444;box-shadow:0 0 8px #ef4444;animation:pulse 1s ease-in-out infinite}\n@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}\n.backend-info{flex:1}\n.backend-state{font-size:14px;font-weight:600;margin-bottom:2px}\n.backend-meta{font-size:11px;opacity:.5}\n.backend-controls{display:flex;gap:6px;flex-wrap:wrap}\n.bbtn{padding:6px 14px;border-radius:6px;font-size:11px;font-weight:600;border:1px solid var(--vscode-panel-border);background:var(--vscode-button-secondaryBackground);color:var(--vscode-button-secondaryForeground);cursor:pointer;transition:all .15s;opacity:.9}\n.bbtn:hover:not(:disabled){opacity:1;transform:translateY(-1px);background:var(--vscode-button-secondaryHoverBackground)}\n.bbtn:disabled{opacity:.3;cursor:not-allowed}\n.bbtn-primary{background:var(--vscode-button-background);color:var(--vscode-button-foreground)}\n.bbtn-primary:hover:not(:disabled){background:var(--vscode-button-hoverBackground)}\n.bbtn-danger{background:#dc262626;color:#ef4444;border-color:#dc2626}\n.bbtn-danger:hover:not(:disabled){background:#dc26264d}\n.bbtn-warning{background:#eab30826;color:#facc15;border-color:#eab308}\n.bbtn-warning:hover:not(:disabled){background:#eab3084d}\n.backend-logs{border-top:1px solid var(--vscode-panel-border);padding-top:12px;margin-top:4px}\n.logs-header{font-size:10px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;opacity:.5;margin-bottom:8px}\n.logs-content{background:var(--vscode-editor-background);border:1px solid var(--vscode-panel-border);border-radius:6px;padding:10px;font-family:var(--vscode-editor-font-family);font-size:10px;line-height:1.6;max-height:180px;overflow-y:auto;color:#a1a1aa}\n.logs-content.empty{opacity:.4;font-style:italic}\n.log-line{margin-bottom:2px}\n</style>\n</head>\n<body>\n<div class="shell">\n\n  \x3c!-- â”€â”€ Header â”€â”€ --\x3e\n  <div class="header">\n    <h1>âš¡ Copilot Engine <span>Autonomous Monitor</span></h1>\n    <div class="header-right">\n      <div id="healthPill" class="pill pill-healthy">\n        <span class="pill-dot"></span>\n        <span id="healthText">Initializing...</span>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- â”€â”€ Worker Status â”€â”€ --\x3e\n  <div class="worker-bar">\n    <span><span id="wdot" class="wdot off"></span> <span id="workerLabel">Worker starting...</span></span>\n    <span>Events: <strong id="evtCount">0</strong></span>\n    <span>Fast runs: <strong id="fastCount">0</strong></span>\n    <span>Idle scans: <strong id="idleCount">0</strong></span>\n    <span>Errors: <strong id="errCount">0</strong></span>\n    <span>Last: <strong id="lastEvt">â€”</strong></span>\n  </div>\n\n  \x3c!-- â”€â”€ Health Gauge â”€â”€ --\x3e\n  <div class="gauge-wrap">\n    <div class="gauge">\n      <svg viewBox="0 0 36 36">\n        <path class="gauge-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>\n        <path id="gaugeFill" class="gauge-fill" stroke="#4ade80" stroke-dasharray="0, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831"/>\n      </svg>\n      <div class="gauge-text">\n        <div id="scoreVal" class="gauge-score">â€”</div>\n        <div class="gauge-label">/ 10</div>\n      </div>\n    </div>\n    <div class="gauge-info">\n      <div id="levelText" class="gauge-level">Waiting for data...</div>\n      <div id="gaugeMeta" class="gauge-meta"></div>\n    </div>\n  </div>\n\n  \x3c!-- â”€â”€ Risk Categories â”€â”€ --\x3e\n  <div class="categories">\n    <div class="cat-card" id="cat-schema"><div id="v-schema" class="cat-val c-green">â€”</div><div class="cat-lbl">Schema</div></div>\n    <div class="cat-card" id="cat-contract"><div id="v-contract" class="cat-val c-green">â€”</div><div class="cat-lbl">Contracts</div></div>\n    <div class="cat-card" id="cat-drift"><div id="v-drift" class="cat-val c-green">â€”</div><div class="cat-lbl">Drift</div></div>\n    <div class="cat-card" id="cat-security"><div id="v-security" class="cat-val c-green">â€”</div><div class="cat-lbl">Security</div></div>\n    <div class="cat-card" id="cat-dependency"><div id="v-dependency" class="cat-val c-green">â€”</div><div class="cat-lbl">Deps</div></div>\n    <div class="cat-card" id="cat-migration"><div id="v-migration" class="cat-val c-green">â€”</div><div class="cat-lbl">Migration</div></div>\n    <div class="cat-card" id="cat-naming"><div id="v-naming" class="cat-val c-green">â€”</div><div class="cat-lbl">Naming</div></div>\n  </div>\n\n  \x3c!-- â”€â”€ Risk Trend â”€â”€ --\x3e\n  <div class="section">\n    <div class="section-title">Risk Trend</div>\n    <div class="trend-wrap">\n      <div class="trend-label">Score / time</div>\n      <svg id="trendSvg" class="trend-svg" preserveAspectRatio="none" viewBox="0 0 400 60"></svg>\n    </div>\n  </div>\n\n  \x3c!-- â”€â”€ Structural Drift â”€â”€ --\x3e\n  <div class="section">\n    <div class="section-title">Structural Drift <span id="driftCount" class="count">0</span></div>\n    <div id="driftPanel" class="panel">\n      <div class="panel-empty">No drift events detected</div>\n    </div>\n  </div>\n\n  \x3c!-- â”€â”€ Circular Dependencies â”€â”€ --\x3e\n  <div class="section">\n    <div class="section-title">Circular Dependencies <span id="circCount" class="count">0</span></div>\n    <div id="circPanel" class="panel">\n      <div class="panel-empty">No circular dependencies</div>\n    </div>\n  </div>\n\n  \x3c!-- â”€â”€ Dead Code â”€â”€ --\x3e\n  <div class="section">\n    <div class="section-title">Dead Code (Never Imported) <span id="deadCount" class="count">0</span></div>\n    <div id="deadPanel" class="panel">\n      <div class="panel-empty">No dead code files detected</div>\n    </div>\n  </div>\n\n  \x3c!-- â”€â”€ Backend Management â”€â”€ --\x3e\n  <div class="section">\n    <div class="section-title">Backend Server</div>\n    <div class="backend-panel">\n      <div class="backend-status">\n        <div class="backend-indicator">\n          <div id="backendDot" class="status-dot status-stopped"></div>\n          <div class="backend-info">\n            <div id="backendState" class="backend-state">Stopped</div>\n            <div id="backendMeta" class="backend-meta">Port: â€” | PID: â€” | Uptime: â€”</div>\n          </div>\n        </div>\n        <div class="backend-controls">\n          <button id="btnStart" class="bbtn bbtn-primary" onclick="send(\'startBackend\')">â–¶ Start</button>\n          <button id="btnStop" class="bbtn bbtn-danger" onclick="send(\'stopBackend\')" disabled>â¹ Stop</button>\n          <button id="btnRestart" class="bbtn bbtn-warning" onclick="send(\'restartBackend\')" disabled>ðŸ”„ Restart</button>\n          <button class="bbtn" onclick="send(\'refreshBackend\')">â†» Refresh</button>\n        </div>\n      </div>\n      <div class="backend-logs">\n        <div class="logs-header">Recent Logs</div>\n        <div id="logsContent" class="logs-content">Waiting for backend status...</div>\n      </div>\n    </div>\n  </div>\n\n  \x3c!-- â”€â”€ Quick Actions â”€â”€ --\x3e\n  <div class="section">\n    <div class="section-title">Quick Actions</div>\n    <div class="actions-grid">\n      <button class="action-btn primary" onclick="send(\'fullScan\')">\n        <span class="icon">ðŸ”</span>\n        <span class="label">Full Scan<small>Complete analysis</small></span>\n      </button>\n      <button class="action-btn warning" onclick="send(\'securityScan\')">\n        <span class="icon">ðŸ›¡ï¸</span>\n        <span class="label">Security<small>Find vulnerabilities</small></span>\n      </button>\n      <button class="action-btn" onclick="send(\'gitAnalysis\')">\n        <span class="icon">ðŸ“Š</span>\n        <span class="label">Git Analysis<small>Review changes</small></span>\n      </button>\n      <button class="action-btn" onclick="send(\'preCommit\')">\n        <span class="icon">âœ…</span>\n        <span class="label">Pre-Commit<small>Validate before commit</small></span>\n      </button>\n      <button class="action-btn" onclick="send(\'validateContracts\')">\n        <span class="icon">ðŸ“‹</span>\n        <span class="label">Contracts<small>API validation</small></span>\n      </button>\n      <button class="action-btn" onclick="send(\'validateSchema\')">\n        <span class="icon">ðŸ—„ï¸</span>\n        <span class="label">Schema<small>Prisma / DB</small></span>\n      </button>\n      <button class="action-btn" onclick="send(\'detectStack\')">\n        <span class="icon">ðŸ”§</span>\n        <span class="label">Detect Stack<small>Languages & frameworks</small></span>\n      </button>\n      <button class="action-btn" onclick="send(\'detectEndpoints\')">\n        <span class="icon">ðŸŒ</span>\n        <span class="label">Endpoints<small>API routes</small></span>\n      </button>\n      <button class="action-btn" onclick="send(\'analyzeCode\')">\n        <span class="icon">ðŸ“</span>\n        <span class="label">Analyze Code<small>Current selection</small></span>\n      </button>\n      <button class="action-btn" onclick="send(\'buildContext\')">\n        <span class="icon">ðŸ§ </span>\n        <span class="label">Build Context<small>For Copilot</small></span>\n      </button>\n    </div>\n  </div>\n\n  \x3c!-- â”€â”€ Minimal Controls â”€â”€ --\x3e\n  <div class="controls">\n    <button class="cbtn" onclick="send(\'toggleFocus\')">Toggle Focus Mode</button>\n    <button class="cbtn" onclick="send(\'showOutput\')">Show Output</button>\n    <button class="cbtn" onclick="send(\'openSettings\')">Settings</button>\n  </div>\n\n  <div class="footer">Copilot Engine â€” Autonomous Structural Auditor + Backend Manager</div>\n</div>\n\n<script>\nconst vscode = acquireVsCodeApi();\nfunction send(cmd, payload) { vscode.postMessage({ command: cmd, ...(payload||{}) }); }\nfunction esc(s) { return (s||\'\').replace(/&/g,\'&amp;\').replace(/</g,\'&lt;\').replace(/>/g,\'&gt;\'); }\n\nfunction scoreColor(v) {\n  if (v <= 2) return \'#4ade80\';\n  if (v <= 4) return \'#facc15\';\n  if (v <= 6) return \'#fb923c\';\n  return \'#ef4444\';\n}\nfunction scoreClass(v) {\n  if (v <= 2) return \'c-green\';\n  if (v <= 4) return \'c-yellow\';\n  if (v <= 6) return \'c-orange\';\n  return \'c-red\';\n}\nfunction cardClass(v) {\n  if (v <= 3) return \'\';\n  if (v <= 6) return \'warn\';\n  return \'danger\';\n}\nfunction pillClass(level) {\n  const l = (level||\'\').toLowerCase();\n  if (l === \'healthy\') return \'pill-healthy\';\n  if (l === \'caution\') return \'pill-caution\';\n  if (l === \'at_risk\' || l === \'at-risk\') return \'pill-atrisk\';\n  if (l === \'degraded\') return \'pill-degraded\';\n  if (l === \'critical\') return \'pill-critical\';\n  return \'pill-healthy\';\n}\nfunction sevIcon(s) {\n  const l = (s||\'\').toLowerCase();\n  if (l === \'critical\') return \'ðŸ”´\';\n  if (l === \'high\') return \'ðŸŸ \';\n  if (l === \'medium\') return \'ðŸŸ¡\';\n  return \'ðŸŸ¢\';\n}\n\nfunction basename(p) { return (p||\'\').replace(/\\\\/g,\'/\').split(\'/\').pop() || p; }\n\n// â”€â”€ Render dashboard data â”€â”€\nfunction renderDashboard(data) {\n  const risk = data.health?.risk_scores || {};\n  const worker = data.health?.worker || {};\n  const graph = data.health?.graph || {};\n  const drift = data.health?.drift || {};\n\n  // Health pill\n  const pill = document.getElementById(\'healthPill\');\n  pill.className = \'pill \' + pillClass(risk.health_level);\n  document.getElementById(\'healthText\').textContent = (risk.health_level || \'UNKNOWN\').replace(\'_\', \' \');\n\n  // Worker bar\n  document.getElementById(\'wdot\').className = \'wdot\' + (worker.started_at ? \'\' : \' off\');\n  document.getElementById(\'workerLabel\').textContent = worker.started_at ? \'Worker running\' : \'Worker stopped\';\n  document.getElementById(\'evtCount\').textContent = worker.events_processed || 0;\n  document.getElementById(\'fastCount\').textContent = worker.fast_path_runs || 0;\n  document.getElementById(\'idleCount\').textContent = worker.idle_runs || 0;\n  document.getElementById(\'errCount\').textContent = worker.errors || 0;\n  document.getElementById(\'lastEvt\').textContent = worker.last_event ? basename(worker.last_event) : \'â€”\';\n\n  // Gauge\n  const score = risk.overall_score ?? 0;\n  const pct = Math.min(score * 10, 100);\n  const color = scoreColor(score);\n  const fill = document.getElementById(\'gaugeFill\');\n  fill.setAttribute(\'stroke-dasharray\', pct + \', 100\');\n  fill.setAttribute(\'stroke\', color);\n  document.getElementById(\'scoreVal\').textContent = score.toFixed(1);\n  document.getElementById(\'scoreVal\').style.color = color;\n  document.getElementById(\'levelText\').textContent = (risk.health_level || \'UNKNOWN\').replace(\'_\', \' \');\n  document.getElementById(\'levelText\').style.color = color;\n\n  const meta = [];\n  if (graph.total_files) meta.push(graph.total_files + \' files indexed\');\n  if (graph.file_edges) meta.push(graph.file_edges + \' dependencies\');\n  if (graph.circular_count) meta.push(graph.circular_count + \' cycles\');\n  if (drift.affected_files) meta.push(drift.affected_files + \' drifted files\');\n  document.getElementById(\'gaugeMeta\').innerHTML = meta.join(\' &middot; \');\n\n  // Category cards\n  const cats = [\'schema\',\'contract\',\'drift\',\'security\',\'dependency\',\'migration\',\'naming\'];\n  for (const c of cats) {\n    const v = risk[c + \'_risk\'] ?? 0;\n    const el = document.getElementById(\'v-\' + c);\n    el.textContent = v.toFixed(1);\n    el.className = \'cat-val \' + scoreClass(v);\n    document.getElementById(\'cat-\' + c).className = \'cat-card \' + cardClass(v);\n  }\n\n  // Trend sparkline\n  renderTrend(data.risk_trend || []);\n\n  // Drift events\n  renderDrifts(data.unresolved_drifts || []);\n\n  // Circular dependencies\n  renderCircular(data.circular_dependencies || []);\n\n  // Dead code\n  renderDeadCode(data.dead_code_files || []);\n}\n\nfunction renderTrend(trend) {\n  const svg = document.getElementById(\'trendSvg\');\n  if (!trend.length) {\n    svg.innerHTML = \'<text x="200" y="35" text-anchor="middle" fill="currentColor" opacity="0.3" font-size="8">No trend data yet</text>\';\n    return;\n  }\n  const w = 400, h = 60, pad = 4;\n  const maxVal = Math.max(...trend.map(t => t.overall_score || 0), 10);\n  const points = trend.map((t, i) => {\n    const x = pad + (i / Math.max(trend.length - 1, 1)) * (w - pad * 2);\n    const y = h - pad - ((t.overall_score || 0) / maxVal) * (h - pad * 2);\n    return x + \',\' + y;\n  });\n  const last = trend[trend.length - 1]?.overall_score || 0;\n  const col = scoreColor(last);\n  svg.innerHTML = \'<polyline points="\' + points.join(\' \') + \'" fill="none" stroke="\' + col + \'" stroke-width="1.5" stroke-linejoin="round"/>\'\n    + \'<circle cx="\' + points[points.length-1].split(\',\')[0] + \'" cy="\' + points[points.length-1].split(\',\')[1] + \'" r="3" fill="\' + col + \'"/>\';\n}\n\nfunction renderDrifts(drifts) {\n  document.getElementById(\'driftCount\').textContent = drifts.length;\n  const panel = document.getElementById(\'driftPanel\');\n  if (!drifts.length) {\n    panel.innerHTML = \'<div class="panel-empty">No drift events â€” structure is stable</div>\';\n    return;\n  }\n  panel.innerHTML = drifts.slice(0, 50).map(d =>\n    \'<div class="row" onclick="send(\'openFile\',{filePath:\'\' + esc(d.file_path||\'\') + \'\'})">\'\n    + \'<span class="row-icon">\' + sevIcon(d.severity) + \'</span>\'\n    + \'<div class="row-body">\'\n    + \'<div class="row-msg sev-\' + (d.severity||\'low\').toLowerCase() + \'"><strong>\' + esc(d.drift_type||\'\') + \'</strong> on \' + esc(d.entity_name||\'?\') + \'</div>\'\n    + \'<div class="row-meta">\' + basename(d.file_path) + (d.old_value && d.new_value ? \' â€” \' + esc(d.old_value) + \' â†’ \' + esc(d.new_value) : \'\') + \'</div>\'\n    + \'</div></div>\'\n  ).join(\'\');\n}\n\nfunction renderCircular(cycles) {\n  document.getElementById(\'circCount\').textContent = cycles.length;\n  const panel = document.getElementById(\'circPanel\');\n  if (!cycles.length) {\n    panel.innerHTML = \'<div class="panel-empty">No circular dependencies â€” graph is clean</div>\';\n    return;\n  }\n  panel.innerHTML = cycles.slice(0, 20).map(c =>\n    \'<div class="row">\'\n    + \'<span class="row-icon">ðŸ”„</span>\'\n    + \'<div class="row-body"><div class="row-msg">\' + c.map(f => basename(f)).join(\' â†’ \') + \'</div></div>\'\n    + \'</div>\'\n  ).join(\'\');\n}\n\nfunction renderDeadCode(files) {\n  document.getElementById(\'deadCount\').textContent = files.length;\n  const panel = document.getElementById(\'deadPanel\');\n  if (!files.length) {\n    panel.innerHTML = \'<div class="panel-empty">All files are imported somewhere</div>\';\n    return;\n  }\n  panel.innerHTML = files.slice(0, 30).map(f =>\n    \'<div class="row" onclick="send(\'openFile\',{filePath:\'\' + esc(f) + \'\'})">\'\n    + \'<span class="row-icon">ðŸ“„</span>\'\n    + \'<div class="row-body"><div class="row-msg">\' + basename(f) + \'</div>\'\n    + \'<div class="row-meta">\' + esc(f) + \'</div>\'\n    + \'</div></div>\'\n  ).join(\'\');\n}\n\n// â”€â”€ Render backend status â”€â”€\nfunction renderBackendStatus(status) {\n  const dot = document.getElementById(\'backendDot\');\n  const state = document.getElementById(\'backendState\');\n  const meta = document.getElementById(\'backendMeta\');\n  const btnStart = document.getElementById(\'btnStart\');\n  const btnStop = document.getElementById(\'btnStop\');\n  const btnRestart = document.getElementById(\'btnRestart\');\n\n  // Update dot and state\n  dot.className = \'status-dot status-\' + status.health;\n  state.textContent = status.running ? (status.health === \'starting\' ? \'Starting...\' : \'Running\') : \'Stopped\';\n  state.style.color = status.health === \'healthy\' ? \'#4ade80\' : status.health === \'starting\' ? \'#facc15\' : status.health === \'unhealthy\' ? \'#ef4444\' : \'#6b7280\';\n\n  // Update metadata\n  const uptimeStr = status.uptime > 0 ? (status.uptime < 60 ? status.uptime + \'s\' : Math.floor(status.uptime / 60) + \'m \' + (status.uptime % 60) + \'s\') : \'â€”\';\n  meta.textContent = \'Port: \' + (status.port || \'â€”\') + \' | PID: \' + (status.pid || \'â€”\') + \' | Uptime: \' + uptimeStr;\n\n  // Update button states\n  btnStart.disabled = status.running;\n  btnStop.disabled = !status.running;\n  btnRestart.disabled = !status.running;\n}\n\nfunction renderBackendLogs(logs) {\n  const content = document.getElementById(\'logsContent\');\n  if (!logs || !logs.length) {\n    content.className = \'logs-content empty\';\n    content.textContent = \'No logs available\';\n    return;\n  }\n  content.className = \'logs-content\';\n  content.innerHTML = logs.map(line => \'<div class="log-line">\' + esc(line) + \'</div>\').join(\'\');\n  content.scrollTop = content.scrollHeight;\n}\n\n// â”€â”€ Message handler â”€â”€\nwindow.addEventListener(\'message\', (event) => {\n  const msg = event.data;\n  if (msg.command === \'dashboard\') {\n    renderDashboard(msg.data);\n  } else if (msg.command === \'backendStatus\') {\n    renderBackendStatus(msg.status);\n  } else if (msg.command === \'backendLogs\') {\n    renderBackendLogs(msg.logs);\n  }\n});\n\n// Signal that webview is ready to receive messages\nvscode.postMessage({ command: \'webviewReady\' });\n<\/script>\n</body>\n</html>'}}t.DashboardPanel=c},699(e,t,s){const n=s(60);n.createWebSocketStream=s(719),n.Server=s(722),n.Receiver=s(286),n.Sender=s(914),n.WebSocket=n,n.WebSocketServer=n.Server,e.exports=n},338(e,t,s){const{EMPTY_BUFFER:n}=s(614),i=Buffer[Symbol.species];function o(e,t,s,n,i){for(let o=0;o<i;o++)s[n+o]=e[o]^t[3&o]}function r(e,t){for(let s=0;s<e.length;s++)e[s]^=t[3&s]}if(e.exports={concat:function(e,t){if(0===e.length)return n;if(1===e.length)return e[0];const s=Buffer.allocUnsafe(t);let o=0;for(let t=0;t<e.length;t++){const n=e[t];s.set(n,o),o+=n.length}return o<t?new i(s.buffer,s.byteOffset,o):s},mask:o,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function e(t){if(e.readOnly=!0,Buffer.isBuffer(t))return t;let s;return t instanceof ArrayBuffer?s=new i(t):ArrayBuffer.isView(t)?s=new i(t.buffer,t.byteOffset,t.byteLength):(s=Buffer.from(t),e.readOnly=!1),s},unmask:r},!process.env.WS_NO_BUFFER_UTIL)try{const t=s(Object(function(){var e=new Error("Cannot find module 'bufferutil'");throw e.code="MODULE_NOT_FOUND",e}()));e.exports.mask=function(e,s,n,i,r){r<48?o(e,s,n,i,r):t.mask(e,s,n,i,r)},e.exports.unmask=function(e,s){e.length<32?r(e,s):t.unmask(e,s)}}catch(e){}},614(e){const t=["nodebuffer","arraybuffer","fragments"],s="undefined"!=typeof Blob;s&&t.push("blob"),e.exports={BINARY_TYPES:t,CLOSE_TIMEOUT:3e4,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:s,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},597(e,t,s){const{kForOnEventAttribute:n,kListener:i}=s(614),o=Symbol("kCode"),r=Symbol("kData"),a=Symbol("kError"),c=Symbol("kMessage"),l=Symbol("kReason"),h=Symbol("kTarget"),d=Symbol("kType"),u=Symbol("kWasClean");class p{constructor(e){this[h]=null,this[d]=e}get target(){return this[h]}get type(){return this[d]}}Object.defineProperty(p.prototype,"target",{enumerable:!0}),Object.defineProperty(p.prototype,"type",{enumerable:!0});class f extends p{constructor(e,t={}){super(e),this[o]=void 0===t.code?0:t.code,this[l]=void 0===t.reason?"":t.reason,this[u]=void 0!==t.wasClean&&t.wasClean}get code(){return this[o]}get reason(){return this[l]}get wasClean(){return this[u]}}Object.defineProperty(f.prototype,"code",{enumerable:!0}),Object.defineProperty(f.prototype,"reason",{enumerable:!0}),Object.defineProperty(f.prototype,"wasClean",{enumerable:!0});class g extends p{constructor(e,t={}){super(e),this[a]=void 0===t.error?null:t.error,this[c]=void 0===t.message?"":t.message}get error(){return this[a]}get message(){return this[c]}}Object.defineProperty(g.prototype,"error",{enumerable:!0}),Object.defineProperty(g.prototype,"message",{enumerable:!0});class m extends p{constructor(e,t={}){super(e),this[r]=void 0===t.data?null:t.data}get data(){return this[r]}}Object.defineProperty(m.prototype,"data",{enumerable:!0});const b={addEventListener(e,t,s={}){for(const o of this.listeners(e))if(!s[n]&&o[i]===t&&!o[n])return;let o;if("message"===e)o=function(e,s){const n=new m("message",{data:s?e:e.toString()});n[h]=this,v(t,this,n)};else if("close"===e)o=function(e,s){const n=new f("close",{code:e,reason:s.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});n[h]=this,v(t,this,n)};else if("error"===e)o=function(e){const s=new g("error",{error:e,message:e.message});s[h]=this,v(t,this,s)};else{if("open"!==e)return;o=function(){const e=new p("open");e[h]=this,v(t,this,e)}}o[n]=!!s[n],o[i]=t,s.once?this.once(e,o):this.on(e,o)},removeEventListener(e,t){for(const s of this.listeners(e))if(s[i]===t&&!s[n]){this.removeListener(e,s);break}}};function v(e,t,s){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,s):e.call(t,s)}e.exports={CloseEvent:f,ErrorEvent:g,Event:p,EventTarget:b,MessageEvent:m}},926(e,t,s){const{tokenChars:n}=s(880);function i(e,t,s){void 0===e[t]?e[t]=[s]:e[t].push(s)}e.exports={format:function(e){return Object.keys(e).map(t=>{let s=e[t];return Array.isArray(s)||(s=[s]),s.map(e=>[t].concat(Object.keys(e).map(t=>{let s=e[t];return Array.isArray(s)||(s=[s]),s.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){const t=Object.create(null);let s,o,r=Object.create(null),a=!1,c=!1,l=!1,h=-1,d=-1,u=-1,p=0;for(;p<e.length;p++)if(d=e.charCodeAt(p),void 0===s)if(-1===u&&1===n[d])-1===h&&(h=p);else if(0===p||32!==d&&9!==d){if(59!==d&&44!==d)throw new SyntaxError(`Unexpected character at index ${p}`);{if(-1===h)throw new SyntaxError(`Unexpected character at index ${p}`);-1===u&&(u=p);const n=e.slice(h,u);44===d?(i(t,n,r),r=Object.create(null)):s=n,h=u=-1}}else-1===u&&-1!==h&&(u=p);else if(void 0===o)if(-1===u&&1===n[d])-1===h&&(h=p);else if(32===d||9===d)-1===u&&-1!==h&&(u=p);else if(59===d||44===d){if(-1===h)throw new SyntaxError(`Unexpected character at index ${p}`);-1===u&&(u=p),i(r,e.slice(h,u),!0),44===d&&(i(t,s,r),r=Object.create(null),s=void 0),h=u=-1}else{if(61!==d||-1===h||-1!==u)throw new SyntaxError(`Unexpected character at index ${p}`);o=e.slice(h,p),h=u=-1}else if(c){if(1!==n[d])throw new SyntaxError(`Unexpected character at index ${p}`);-1===h?h=p:a||(a=!0),c=!1}else if(l)if(1===n[d])-1===h&&(h=p);else if(34===d&&-1!==h)l=!1,u=p;else{if(92!==d)throw new SyntaxError(`Unexpected character at index ${p}`);c=!0}else if(34===d&&61===e.charCodeAt(p-1))l=!0;else if(-1===u&&1===n[d])-1===h&&(h=p);else if(-1===h||32!==d&&9!==d){if(59!==d&&44!==d)throw new SyntaxError(`Unexpected character at index ${p}`);{if(-1===h)throw new SyntaxError(`Unexpected character at index ${p}`);-1===u&&(u=p);let n=e.slice(h,u);a&&(n=n.replace(/\\/g,""),a=!1),i(r,o,n),44===d&&(i(t,s,r),r=Object.create(null),s=void 0),o=void 0,h=u=-1}}else-1===u&&(u=p);if(-1===h||l||32===d||9===d)throw new SyntaxError("Unexpected end of input");-1===u&&(u=p);const f=e.slice(h,u);return void 0===s?i(t,f,r):(void 0===o?i(r,f,!0):i(r,o,a?f.replace(/\\/g,""):f),i(t,s,r)),t}}},759(e){const t=Symbol("kDone"),s=Symbol("kRun");e.exports=class{constructor(e){this[t]=()=>{this.pending--,this[s]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[s]()}[s](){if(this.pending!==this.concurrency&&this.jobs.length){const e=this.jobs.shift();this.pending++,e(this[t])}}}},971(e,t,s){const n=s(106),i=s(338),o=s(759),{kStatusCode:r}=s(614),a=Buffer[Symbol.species],c=Buffer.from([0,0,255,255]),l=Symbol("permessage-deflate"),h=Symbol("total-length"),d=Symbol("callback"),u=Symbol("buffers"),p=Symbol("error");let f;function g(e){this[u].push(e),this[h]+=e.length}function m(e){this[h]+=e.length,this[l]._maxPayload<1||this[h]<=this[l]._maxPayload?this[u].push(e):(this[p]=new RangeError("Max payload size exceeded"),this[p].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[p][r]=1009,this.removeListener("data",m),this.reset())}function b(e){this[l]._inflate=null,this[p]?this[d](this[p]):(e[r]=1007,this[d](e))}e.exports=class{constructor(e,t,s){if(this._maxPayload=0|s,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,!f){const e=void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10;f=new o(e)}}static get extensionName(){return"permessage-deflate"}offer(){const e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){const e=this._deflate[d];this._deflate.close(),this._deflate=null,e&&e(new Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){const t=this._options,s=e.find(e=>!(!1===t.serverNoContextTakeover&&e.server_no_context_takeover||e.server_max_window_bits&&(!1===t.serverMaxWindowBits||"number"==typeof t.serverMaxWindowBits&&t.serverMaxWindowBits>e.server_max_window_bits)||"number"==typeof t.clientMaxWindowBits&&!e.client_max_window_bits));if(!s)throw new Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(s.server_no_context_takeover=!0),t.clientNoContextTakeover&&(s.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(s.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?s.client_max_window_bits=t.clientMaxWindowBits:!0!==s.client_max_window_bits&&!1!==t.clientMaxWindowBits||delete s.client_max_window_bits,s}acceptAsClient(e){const t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw new Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw new Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let s=e[t];if(s.length>1)throw new Error(`Parameter "${t}" must have only a single value`);if(s=s[0],"client_max_window_bits"===t){if(!0!==s){const e=+s;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${s}`);s=e}else if(!this._isServer)throw new TypeError(`Invalid value for parameter "${t}": ${s}`)}else if("server_max_window_bits"===t){const e=+s;if(!Number.isInteger(e)||e<8||e>15)throw new TypeError(`Invalid value for parameter "${t}": ${s}`);s=e}else{if("client_no_context_takeover"!==t&&"server_no_context_takeover"!==t)throw new Error(`Unknown parameter "${t}"`);if(!0!==s)throw new TypeError(`Invalid value for parameter "${t}": ${s}`)}e[t]=s})}),e}decompress(e,t,s){f.add(n=>{this._decompress(e,t,(e,t)=>{n(),s(e,t)})})}compress(e,t,s){f.add(n=>{this._compress(e,t,(e,t)=>{n(),s(e,t)})})}_decompress(e,t,s){const o=this._isServer?"client":"server";if(!this._inflate){const e=`${o}_max_window_bits`,t="number"!=typeof this.params[e]?n.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=n.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[l]=this,this._inflate[h]=0,this._inflate[u]=[],this._inflate.on("error",b),this._inflate.on("data",m)}this._inflate[d]=s,this._inflate.write(e),t&&this._inflate.write(c),this._inflate.flush(()=>{const e=this._inflate[p];if(e)return this._inflate.close(),this._inflate=null,void s(e);const n=i.concat(this._inflate[u],this._inflate[h]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[h]=0,this._inflate[u]=[],t&&this.params[`${o}_no_context_takeover`]&&this._inflate.reset()),s(null,n)})}_compress(e,t,s){const o=this._isServer?"server":"client";if(!this._deflate){const e=`${o}_max_window_bits`,t="number"!=typeof this.params[e]?n.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=n.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[h]=0,this._deflate[u]=[],this._deflate.on("data",g)}this._deflate[d]=s,this._deflate.write(e),this._deflate.flush(n.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=i.concat(this._deflate[u],this._deflate[h]);t&&(e=new a(e.buffer,e.byteOffset,e.length-4)),this._deflate[d]=null,this._deflate[h]=0,this._deflate[u]=[],t&&this.params[`${o}_no_context_takeover`]&&this._deflate.reset(),s(null,e)})}}},286(e,t,s){const{Writable:n}=s(203),i=s(971),{BINARY_TYPES:o,EMPTY_BUFFER:r,kStatusCode:a,kWebSocket:c}=s(614),{concat:l,toArrayBuffer:h,unmask:d}=s(338),{isValidStatusCode:u,isValidUTF8:p}=s(880),f=Buffer[Symbol.species];e.exports=class extends n{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||o[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[c]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,s){if(8===this._opcode&&0==this._state)return s();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(s)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){const t=this._buffers[0];return this._buffers[0]=new f(t.buffer,t.byteOffset+e,t.length-e),new f(t.buffer,t.byteOffset,e)}const t=Buffer.allocUnsafe(e);do{const s=this._buffers[0],n=t.length-e;e>=s.length?t.set(this._buffers.shift(),n):(t.set(new Uint8Array(s.buffer,s.byteOffset,e),n),this._buffers[0]=new f(s.buffer,s.byteOffset+e,s.length-e)),e-=s.length}while(e>0);return t}startLoop(e){this._loop=!0;do{switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:return void(this._loop=!1)}}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2)return void(this._loop=!1);const t=this.consume(2);if(48&t[0])return void e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));const s=!(64&~t[0]);if(!s||this._extensions[i.extensionName]){if(this._fin=!(128&~t[0]),this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(s)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(!this._fragmented)return void e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented)return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));this._compressed=s}else{if(!(this._opcode>7&&this._opcode<11))return void e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));if(!this._fin)return void e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));if(s)return void e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength)return void e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"))}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=!(128&~t[1]),this._isServer){if(!this._masked)return void e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"))}else if(this._masked)return void e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}else e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"))}getPayloadLength16(e){this._bufferedBytes<2?this._loop=!1:(this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e))}getPayloadLength64(e){if(this._bufferedBytes<8)return void(this._loop=!1);const t=this.consume(8),s=t.readUInt32BE(0);s>Math.pow(2,21)-1?e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH")):(this._payloadLength=s*Math.pow(2,32)+t.readUInt32BE(4),this.haveLength(e))}haveLength(e){this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)?e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH")):this._masked?this._state=3:this._state=4}getMask(){this._bufferedBytes<4?this._loop=!1:(this._mask=this.consume(4),this._state=4)}getData(e){let t=r;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength)return void(this._loop=!1);t=this.consume(this._payloadLength),this._masked&&0!==(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])&&d(t,this._mask)}if(this._opcode>7)this.controlMessage(t,e);else{if(this._compressed)return this._state=5,void this.decompress(t,e);t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}}decompress(e,t){this._extensions[i.extensionName].decompress(e,this._fin,(e,s)=>{if(e)return t(e);if(s.length){if(this._messageLength+=s.length,this._messageLength>this._maxPayload&&this._maxPayload>0){const e=this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH");return void t(e)}this._fragments.push(s)}this.dataMessage(t),0===this._state&&this.startLoop(t)})}dataMessage(e){if(!this._fin)return void(this._state=0);const t=this._messageLength,s=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let n;n="nodebuffer"===this._binaryType?l(s,t):"arraybuffer"===this._binaryType?h(l(s,t)):"blob"===this._binaryType?new Blob(s):s,this._allowSynchronousEvents?(this.emit("message",n,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",n,!0),this._state=0,this.startLoop(e)}))}else{const n=l(s,t);if(!this._skipUTF8Validation&&!p(n)){const t=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void e(t)}5===this._state||this._allowSynchronousEvents?(this.emit("message",n,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",n,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8!==this._opcode)this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}));else{if(0===e.length)this._loop=!1,this.emit("conclude",1005,r),this.end();else{const s=e.readUInt16BE(0);if(!u(s)){const e=this.createError(RangeError,`invalid status code ${s}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE");return void t(e)}const n=new f(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!p(n)){const e=this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8");return void t(e)}this._loop=!1,this.emit("conclude",s,n),this.end()}this._state=0}}createError(e,t,s,n,i){this._loop=!1,this._errored=!0;const o=new e(s?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=i,o[a]=n,o}}},914(e,t,s){const{Duplex:n}=s(203),{randomFillSync:i}=s(982),o=s(971),{EMPTY_BUFFER:r,kWebSocket:a,NOOP:c}=s(614),{isBlob:l,isValidStatusCode:h}=s(880),{mask:d,toBuffer:u}=s(338),p=Symbol("kByteLength"),f=Buffer.alloc(4),g=8192;let m,b=g;class v{constructor(e,t,s){this._extensions=t||{},s&&(this._generateMask=s,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=c,this[a]=void 0}static frame(e,t){let s,n,o=!1,r=2,a=!1;t.mask&&(s=t.maskBuffer||f,t.generateMask?t.generateMask(s):(b===g&&(void 0===m&&(m=Buffer.alloc(g)),i(m,0,g),b=0),s[0]=m[b++],s[1]=m[b++],s[2]=m[b++],s[3]=m[b++]),a=0===(s[0]|s[1]|s[2]|s[3]),r=6),"string"==typeof e?n=t.mask&&!a||void 0===t[p]?(e=Buffer.from(e)).length:t[p]:(n=e.length,o=t.mask&&t.readOnly&&!a);let c=n;n>=65536?(r+=8,c=127):n>125&&(r+=2,c=126);const l=Buffer.allocUnsafe(o?n+r:r);return l[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(l[0]|=64),l[1]=c,126===c?l.writeUInt16BE(n,2):127===c&&(l[2]=l[3]=0,l.writeUIntBE(n,4,6)),t.mask?(l[1]|=128,l[r-4]=s[0],l[r-3]=s[1],l[r-2]=s[2],l[r-1]=s[3],a?[l,e]:o?(d(e,s,l,r,n),[l]):(d(e,s,e,0,n),[l,e])):[l,e]}close(e,t,s,n){let i;if(void 0===e)i=r;else{if("number"!=typeof e||!h(e))throw new TypeError("First argument must be a valid error code number");if(void 0!==t&&t.length){const s=Buffer.byteLength(t);if(s>123)throw new RangeError("The message must not be greater than 123 bytes");i=Buffer.allocUnsafe(2+s),i.writeUInt16BE(e,0),"string"==typeof t?i.write(t,2):i.set(t,2)}else i=Buffer.allocUnsafe(2),i.writeUInt16BE(e,0)}const o={[p]:i.length,fin:!0,generateMask:this._generateMask,mask:s,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,i,!1,o,n]):this.sendFrame(v.frame(i,o),n)}ping(e,t,s){let n,i;if("string"==typeof e?(n=Buffer.byteLength(e),i=!1):l(e)?(n=e.size,i=!1):(n=(e=u(e)).length,i=u.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");const o={[p]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};l(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,s]):this.getBlobData(e,!1,o,s):0!==this._state?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(v.frame(e,o),s)}pong(e,t,s){let n,i;if("string"==typeof e?(n=Buffer.byteLength(e),i=!1):l(e)?(n=e.size,i=!1):(n=(e=u(e)).length,i=u.readOnly),n>125)throw new RangeError("The data size must not be greater than 125 bytes");const o={[p]:n,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};l(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,s]):this.getBlobData(e,!1,o,s):0!==this._state?this.enqueue([this.dispatch,e,!1,o,s]):this.sendFrame(v.frame(e,o),s)}send(e,t,s){const n=this._extensions[o.extensionName];let i,r,a=t.binary?2:1,c=t.compress;"string"==typeof e?(i=Buffer.byteLength(e),r=!1):l(e)?(i=e.size,r=!1):(i=(e=u(e)).length,r=u.readOnly),this._firstFragment?(this._firstFragment=!1,c&&n&&n.params[n._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(c=i>=n._threshold),this._compress=c):(c=!1,a=0),t.fin&&(this._firstFragment=!0);const h={[p]:i,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:r,rsv1:c};l(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,h,s]):this.getBlobData(e,this._compress,h,s):0!==this._state?this.enqueue([this.dispatch,e,this._compress,h,s]):this.dispatch(e,this._compress,h,s)}getBlobData(e,t,s,n){this._bufferedBytes+=s[p],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){const e=new Error("The socket was closed while the blob was being read");return void process.nextTick(w,this,e,n)}this._bufferedBytes-=s[p];const i=u(e);t?this.dispatch(i,t,s,n):(this._state=0,this.sendFrame(v.frame(i,s),n),this.dequeue())}).catch(e=>{process.nextTick(y,this,e,n)})}dispatch(e,t,s,n){if(!t)return void this.sendFrame(v.frame(e,s),n);const i=this._extensions[o.extensionName];this._bufferedBytes+=s[p],this._state=1,i.compress(e,s.fin,(e,t)=>{this._socket.destroyed?w(this,new Error("The socket was closed while data was being compressed"),n):(this._bufferedBytes-=s[p],this._state=0,s.readOnly=!1,this.sendFrame(v.frame(t,s),n),this.dequeue())})}dequeue(){for(;0===this._state&&this._queue.length;){const e=this._queue.shift();this._bufferedBytes-=e[3][p],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][p],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function w(e,t,s){"function"==typeof s&&s(t);for(let s=0;s<e._queue.length;s++){const n=e._queue[s],i=n[n.length-1];"function"==typeof i&&i(t)}}function y(e,t,s){w(e,t,s),e.onerror(t)}e.exports=v},719(e,t,s){s(60);const{Duplex:n}=s(203);function i(e){e.emit("close")}function o(){!this.destroyed&&this._writableState.finished&&this.destroy()}function r(e){this.removeListener("error",r),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}e.exports=function(e,t){let s=!0;const a=new n({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(t,s){const n=!s&&a._readableState.objectMode?t.toString():t;a.push(n)||e.pause()}),e.once("error",function(e){a.destroyed||(s=!1,a.destroy(e))}),e.once("close",function(){a.destroyed||a.push(null)}),a._destroy=function(t,n){if(e.readyState===e.CLOSED)return n(t),void process.nextTick(i,a);let o=!1;e.once("error",function(e){o=!0,n(e)}),e.once("close",function(){o||n(t),process.nextTick(i,a)}),s&&e.terminate()},a._final=function(t){e.readyState!==e.CONNECTING?null!==e._socket&&(e._socket._writableState.finished?(t(),a._readableState.endEmitted&&a.destroy()):(e._socket.once("finish",function(){t()}),e.close())):e.once("open",function(){a._final(t)})},a._read=function(){e.isPaused&&e.resume()},a._write=function(t,s,n){e.readyState!==e.CONNECTING?e.send(t,n):e.once("open",function(){a._write(t,s,n)})},a.on("end",o),a.on("error",r),a}},237(e,t,s){const{tokenChars:n}=s(880);e.exports={parse:function(e){const t=new Set;let s=-1,i=-1,o=0;for(;o<e.length;o++){const r=e.charCodeAt(o);if(-1===i&&1===n[r])-1===s&&(s=o);else if(0===o||32!==r&&9!==r){if(44!==r)throw new SyntaxError(`Unexpected character at index ${o}`);{if(-1===s)throw new SyntaxError(`Unexpected character at index ${o}`);-1===i&&(i=o);const n=e.slice(s,i);if(t.has(n))throw new SyntaxError(`The "${n}" subprotocol is duplicated`);t.add(n),s=i=-1}}else-1===i&&-1!==s&&(i=o)}if(-1===s||-1!==i)throw new SyntaxError("Unexpected end of input");const r=e.slice(s,o);if(t.has(r))throw new SyntaxError(`The "${r}" subprotocol is duplicated`);return t.add(r),t}}},880(e,t,s){const{isUtf8:n}=s(181),{hasBlob:i}=s(614);function o(e){const t=e.length;let s=0;for(;s<t;)if(128&e[s])if(192==(224&e[s])){if(s+1===t||128!=(192&e[s+1])||192==(254&e[s]))return!1;s+=2}else if(224==(240&e[s])){if(s+2>=t||128!=(192&e[s+1])||128!=(192&e[s+2])||224===e[s]&&128==(224&e[s+1])||237===e[s]&&160==(224&e[s+1]))return!1;s+=3}else{if(240!=(248&e[s]))return!1;if(s+3>=t||128!=(192&e[s+1])||128!=(192&e[s+2])||128!=(192&e[s+3])||240===e[s]&&128==(240&e[s+1])||244===e[s]&&e[s+1]>143||e[s]>244)return!1;s+=4}else s++;return!0}if(e.exports={isBlob:function(e){return i&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:o,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},n)e.exports.isValidUTF8=function(e){return e.length<24?o(e):n(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{const t=s(Object(function(){var e=new Error("Cannot find module 'utf-8-validate'");throw e.code="MODULE_NOT_FOUND",e}()));e.exports.isValidUTF8=function(e){return e.length<32?o(e):t(e)}}catch(e){}},722(e,t,s){const n=s(434),i=s(611),{Duplex:o}=s(203),{createHash:r}=s(982),a=s(926),c=s(971),l=s(237),h=s(60),{CLOSE_TIMEOUT:d,GUID:u,kWebSocket:p}=s(614),f=/^[+/0-9A-Za-z]{22}==$/;function g(e){e._state=2,e.emit("close")}function m(){this.destroy()}function b(e,t,s,n){s=s||i.STATUS_CODES[t],n={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(s),...n},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${i.STATUS_CODES[t]}\r\n`+Object.keys(n).map(e=>`${e}: ${n[e]}`).join("\r\n")+"\r\n\r\n"+s)}function v(e,t,s,n,i,o){if(e.listenerCount("wsClientError")){const n=new Error(i);Error.captureStackTrace(n,v),e.emit("wsClientError",n,s,t)}else b(s,n,i,o)}e.exports=class extends n{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,closeTimeout:d,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:h,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw new TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=i.createServer((e,t)=>{const s=i.STATUS_CODES[426];t.writeHead(426,{"Content-Length":s.length,"Content-Type":"text/plain"}),t.end(s)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){const e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(const s of Object.keys(t))e.on(s,t[s]);return function(){for(const s of Object.keys(t))e.removeListener(s,t[s])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,s,n)=>{this.handleUpgrade(t,s,n,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw new Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state)return e&&this.once("close",()=>{e(new Error("The server is not running"))}),void process.nextTick(g,this);if(e&&this.once("close",e),1!==this._state)if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(g,this);else{const e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{g(this)})}}shouldHandle(e){if(this.options.path){const t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,s,n){t.on("error",m);const i=e.headers["sec-websocket-key"],o=e.headers.upgrade,r=+e.headers["sec-websocket-version"];if("GET"!==e.method)return void v(this,e,t,405,"Invalid HTTP method");if(void 0===o||"websocket"!==o.toLowerCase())return void v(this,e,t,400,"Invalid Upgrade header");if(void 0===i||!f.test(i))return void v(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");if(13!==r&&8!==r)return void v(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});if(!this.shouldHandle(e))return void b(t,400);const h=e.headers["sec-websocket-protocol"];let d=new Set;if(void 0!==h)try{d=l.parse(h)}catch(s){return void v(this,e,t,400,"Invalid Sec-WebSocket-Protocol header")}const u=e.headers["sec-websocket-extensions"],p={};if(this.options.perMessageDeflate&&void 0!==u){const s=new c(this.options.perMessageDeflate,!0,this.options.maxPayload);try{const e=a.parse(u);e[c.extensionName]&&(s.accept(e[c.extensionName]),p[c.extensionName]=s)}catch(s){return void v(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header")}}if(this.options.verifyClient){const o={origin:e.headers[8===r?"sec-websocket-origin":"origin"],secure:!(!e.socket.authorized&&!e.socket.encrypted),req:e};if(2===this.options.verifyClient.length)return void this.options.verifyClient(o,(o,r,a,c)=>{if(!o)return b(t,r||401,a,c);this.completeUpgrade(p,i,d,e,t,s,n)});if(!this.options.verifyClient(o))return b(t,401)}this.completeUpgrade(p,i,d,e,t,s,n)}completeUpgrade(e,t,s,n,i,o,l){if(!i.readable||!i.writable)return i.destroy();if(i[p])throw new Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return b(i,503);const h=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${r("sha1").update(t+u).digest("base64")}`],d=new this.options.WebSocket(null,void 0,this.options);if(s.size){const e=this.options.handleProtocols?this.options.handleProtocols(s,n):s.values().next().value;e&&(h.push(`Sec-WebSocket-Protocol: ${e}`),d._protocol=e)}if(e[c.extensionName]){const t=e[c.extensionName].params,s=a.format({[c.extensionName]:[t]});h.push(`Sec-WebSocket-Extensions: ${s}`),d._extensions=e}this.emit("headers",h,n),i.write(h.concat("\r\n").join("\r\n")),i.removeListener("error",m),d.setSocket(i,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(d),d.on("close",()=>{this.clients.delete(d),this._shouldEmitClose&&!this.clients.size&&process.nextTick(g,this)})),l(d,n)}}},60(e,t,s){const n=s(434),i=s(692),o=s(611),r=s(278),a=s(756),{randomBytes:c,createHash:l}=s(982),{Duplex:h,Readable:d}=s(203),{URL:u}=s(16),p=s(971),f=s(286),g=s(914),{isBlob:m}=s(880),{BINARY_TYPES:b,CLOSE_TIMEOUT:v,EMPTY_BUFFER:w,GUID:y,kForOnEventAttribute:_,kListener:k,kStatusCode:x,kWebSocket:S,NOOP:C}=s(614),{EventTarget:{addEventListener:E,removeEventListener:P}}=s(597),{format:T,parse:O}=s(926),{toBuffer:$}=s(338),D=Symbol("kAborted"),I=[8,13],M=["CONNECTING","OPEN","CLOSING","CLOSED"],B=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class L extends n{constructor(e,t,s){super(),this._binaryType=b[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=w,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=L.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(s=t,t=[]):t=[t]),j(this,e,t,s)):(this._autoPong=s.autoPong,this._closeTimeout=s.closeTimeout,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){b.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,s){const n=new f({allowSynchronousEvents:s.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:s.maxPayload,skipUTF8Validation:s.skipUTF8Validation}),i=new g(e,this._extensions,s.generateMask);this._receiver=n,this._sender=i,this._socket=e,n[S]=this,i[S]=this,e[S]=this,n.on("conclude",U),n.on("drain",z),n.on("error",H),n.on("message",V),n.on("ping",q),n.on("pong",Y),i.onerror=J,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",Q),e.on("data",Z),e.on("end",ee),e.on("error",te),this._readyState=L.OPEN,this.emit("open")}emitClose(){if(!this._socket)return this._readyState=L.CLOSED,void this.emit("close",this._closeCode,this._closeMessage);this._extensions[p.extensionName]&&this._extensions[p.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=L.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==L.CLOSED){if(this.readyState===L.CONNECTING){const e="WebSocket was closed before the connection was established";return void F(this,this._req,e)}this.readyState!==L.CLOSING?(this._readyState=L.CLOSING,this._sender.close(e,t,!this._isServer,e=>{e||(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),X(this)):this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end()}}pause(){this.readyState!==L.CONNECTING&&this.readyState!==L.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,s){if(this.readyState===L.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(s=e,e=t=void 0):"function"==typeof t&&(s=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===L.OPEN?(void 0===t&&(t=!this._isServer),this._sender.ping(e||w,t,s)):W(this,e,s)}pong(e,t,s){if(this.readyState===L.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");"function"==typeof e?(s=e,e=t=void 0):"function"==typeof t&&(s=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState===L.OPEN?(void 0===t&&(t=!this._isServer),this._sender.pong(e||w,t,s)):W(this,e,s)}resume(){this.readyState!==L.CONNECTING&&this.readyState!==L.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,s){if(this.readyState===L.CONNECTING)throw new Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(s=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==L.OPEN)return void W(this,e,s);const n={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[p.extensionName]||(n.compress=!1),this._sender.send(e||w,n,s)}terminate(){if(this.readyState!==L.CLOSED){if(this.readyState===L.CONNECTING){const e="WebSocket was closed before the connection was established";return void F(this,this._req,e)}this._socket&&(this._readyState=L.CLOSING,this._socket.destroy())}}}function j(e,t,s,n){const r={allowSynchronousEvents:!0,autoPong:!0,closeTimeout:v,protocolVersion:I[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...n,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(e._autoPong=r.autoPong,e._closeTimeout=r.closeTimeout,!I.includes(r.protocolVersion))throw new RangeError(`Unsupported protocol version: ${r.protocolVersion} (supported versions: ${I.join(", ")})`);let a;if(t instanceof u)a=t;else try{a=new u(t)}catch(e){throw new SyntaxError(`Invalid URL: ${t}`)}"http:"===a.protocol?a.protocol="ws:":"https:"===a.protocol&&(a.protocol="wss:"),e._url=a.href;const h="wss:"===a.protocol,d="ws+unix:"===a.protocol;let f;if("ws:"===a.protocol||h||d?d&&!a.pathname?f="The URL's pathname is empty":a.hash&&(f="The URL contains a fragment identifier"):f='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',f){const t=new SyntaxError(f);if(0===e._redirects)throw t;return void N(e,t)}const g=h?443:80,m=c(16).toString("base64"),b=h?i.request:o.request,w=new Set;let _,k;if(r.createConnection=r.createConnection||(h?R:A),r.defaultPort=r.defaultPort||g,r.port=a.port||g,r.host=a.hostname.startsWith("[")?a.hostname.slice(1,-1):a.hostname,r.headers={...r.headers,"Sec-WebSocket-Version":r.protocolVersion,"Sec-WebSocket-Key":m,Connection:"Upgrade",Upgrade:"websocket"},r.path=a.pathname+a.search,r.timeout=r.handshakeTimeout,r.perMessageDeflate&&(_=new p(!0!==r.perMessageDeflate?r.perMessageDeflate:{},!1,r.maxPayload),r.headers["Sec-WebSocket-Extensions"]=T({[p.extensionName]:_.offer()})),s.length){for(const e of s){if("string"!=typeof e||!B.test(e)||w.has(e))throw new SyntaxError("An invalid or duplicated subprotocol was specified");w.add(e)}r.headers["Sec-WebSocket-Protocol"]=s.join(",")}if(r.origin&&(r.protocolVersion<13?r.headers["Sec-WebSocket-Origin"]=r.origin:r.headers.Origin=r.origin),(a.username||a.password)&&(r.auth=`${a.username}:${a.password}`),d){const e=r.path.split(":");r.socketPath=e[0],r.path=e[1]}if(r.followRedirects){if(0===e._redirects){e._originalIpc=d,e._originalSecure=h,e._originalHostOrSocketPath=d?r.socketPath:a.host;const t=n&&n.headers;if(n={...n,headers:{}},t)for(const[e,s]of Object.entries(t))n.headers[e.toLowerCase()]=s}else if(0===e.listenerCount("redirect")){const t=d?!!e._originalIpc&&r.socketPath===e._originalHostOrSocketPath:!e._originalIpc&&a.host===e._originalHostOrSocketPath;(!t||e._originalSecure&&!h)&&(delete r.headers.authorization,delete r.headers.cookie,t||delete r.headers.host,r.auth=void 0)}r.auth&&!n.headers.authorization&&(n.headers.authorization="Basic "+Buffer.from(r.auth).toString("base64")),k=e._req=b(r),e._redirects&&e.emit("redirect",e.url,k)}else k=e._req=b(r);r.timeout&&k.on("timeout",()=>{F(e,k,"Opening handshake has timed out")}),k.on("error",t=>{null===k||k[D]||(k=e._req=null,N(e,t))}),k.on("response",i=>{const o=i.headers.location,a=i.statusCode;if(o&&r.followRedirects&&a>=300&&a<400){if(++e._redirects>r.maxRedirects)return void F(e,k,"Maximum redirects exceeded");let i;k.abort();try{i=new u(o,t)}catch(t){const s=new SyntaxError(`Invalid URL: ${o}`);return void N(e,s)}j(e,i,s,n)}else e.emit("unexpected-response",k,i)||F(e,k,`Unexpected server response: ${i.statusCode}`)}),k.on("upgrade",(t,s,n)=>{if(e.emit("upgrade",t),e.readyState!==L.CONNECTING)return;k=e._req=null;const i=t.headers.upgrade;if(void 0===i||"websocket"!==i.toLowerCase())return void F(e,s,"Invalid Upgrade header");const o=l("sha1").update(m+y).digest("base64");if(t.headers["sec-websocket-accept"]!==o)return void F(e,s,"Invalid Sec-WebSocket-Accept header");const a=t.headers["sec-websocket-protocol"];let c;if(void 0!==a?w.size?w.has(a)||(c="Server sent an invalid subprotocol"):c="Server sent a subprotocol but none was requested":w.size&&(c="Server sent no subprotocol"),c)return void F(e,s,c);a&&(e._protocol=a);const h=t.headers["sec-websocket-extensions"];if(void 0!==h){if(!_)return void F(e,s,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");let t;try{t=O(h)}catch(t){return void F(e,s,"Invalid Sec-WebSocket-Extensions header")}const n=Object.keys(t);if(1!==n.length||n[0]!==p.extensionName)return void F(e,s,"Server indicated an extension that was not requested");try{_.accept(t[p.extensionName])}catch(t){return void F(e,s,"Invalid Sec-WebSocket-Extensions header")}e._extensions[p.extensionName]=_}e.setSocket(s,n,{allowSynchronousEvents:r.allowSynchronousEvents,generateMask:r.generateMask,maxPayload:r.maxPayload,skipUTF8Validation:r.skipUTF8Validation})}),r.finishRequest?r.finishRequest(k,e):k.end()}function N(e,t){e._readyState=L.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function A(e){return e.path=e.socketPath,r.connect(e)}function R(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=r.isIP(e.host)?"":e.host),a.connect(e)}function F(e,t,s){e._readyState=L.CLOSING;const n=new Error(s);Error.captureStackTrace(n,F),t.setHeader?(t[D]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(N,e,n)):(t.destroy(n),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function W(e,t,s){if(t){const s=m(t)?t.size:$(t).length;e._socket?e._sender._bufferedBytes+=s:e._bufferedAmount+=s}if(s){const t=new Error(`WebSocket is not open: readyState ${e.readyState} (${M[e.readyState]})`);process.nextTick(s,t)}}function U(e,t){const s=this[S];s._closeFrameReceived=!0,s._closeMessage=t,s._closeCode=e,void 0!==s._socket[S]&&(s._socket.removeListener("data",Z),process.nextTick(K,s._socket),1005===e?s.close():s.close(e,t))}function z(){const e=this[S];e.isPaused||e._socket.resume()}function H(e){const t=this[S];void 0!==t._socket[S]&&(t._socket.removeListener("data",Z),process.nextTick(K,t._socket),t.close(e[x])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function G(){this[S].emitClose()}function V(e,t){this[S].emit("message",e,t)}function q(e){const t=this[S];t._autoPong&&t.pong(e,!this._isServer,C),t.emit("ping",e)}function Y(e){this[S].emit("pong",e)}function K(e){e.resume()}function J(e){const t=this[S];t.readyState!==L.CLOSED&&(t.readyState===L.OPEN&&(t._readyState=L.CLOSING,X(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function X(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),e._closeTimeout)}function Q(){const e=this[S];if(this.removeListener("close",Q),this.removeListener("data",Z),this.removeListener("end",ee),e._readyState=L.CLOSING,!this._readableState.endEmitted&&!e._closeFrameReceived&&!e._receiver._writableState.errorEmitted&&0!==this._readableState.length){const t=this.read(this._readableState.length);e._receiver.write(t)}e._receiver.end(),this[S]=void 0,clearTimeout(e._closeTimer),e._receiver._writableState.finished||e._receiver._writableState.errorEmitted?e.emitClose():(e._receiver.on("error",G),e._receiver.on("finish",G))}function Z(e){this[S]._receiver.write(e)||this.pause()}function ee(){const e=this[S];e._readyState=L.CLOSING,e._receiver.end(),this.end()}function te(){const e=this[S];this.removeListener("error",te),this.on("error",C),e&&(e._readyState=L.CLOSING,this.destroy())}Object.defineProperty(L,"CONNECTING",{enumerable:!0,value:M.indexOf("CONNECTING")}),Object.defineProperty(L.prototype,"CONNECTING",{enumerable:!0,value:M.indexOf("CONNECTING")}),Object.defineProperty(L,"OPEN",{enumerable:!0,value:M.indexOf("OPEN")}),Object.defineProperty(L.prototype,"OPEN",{enumerable:!0,value:M.indexOf("OPEN")}),Object.defineProperty(L,"CLOSING",{enumerable:!0,value:M.indexOf("CLOSING")}),Object.defineProperty(L.prototype,"CLOSING",{enumerable:!0,value:M.indexOf("CLOSING")}),Object.defineProperty(L,"CLOSED",{enumerable:!0,value:M.indexOf("CLOSED")}),Object.defineProperty(L.prototype,"CLOSED",{enumerable:!0,value:M.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(L.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(L.prototype,`on${e}`,{enumerable:!0,get(){for(const t of this.listeners(e))if(t[_])return t[k];return null},set(t){for(const t of this.listeners(e))if(t[_]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[_]:!0})}})}),L.prototype.addEventListener=E,L.prototype.removeEventListener=P,e.exports=L},398(e){e.exports=require("vscode")},181(e){e.exports=require("buffer")},317(e){e.exports=require("child_process")},982(e){e.exports=require("crypto")},434(e){e.exports=require("events")},896(e){e.exports=require("fs")},611(e){e.exports=require("http")},692(e){e.exports=require("https")},278(e){e.exports=require("net")},928(e){e.exports=require("path")},203(e){e.exports=require("stream")},756(e){e.exports=require("tls")},16(e){e.exports=require("url")},106(e){e.exports=require("zlib")}},t={},s=function s(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,s),o.exports}(265);module.exports=s})();
//# sourceMappingURL=extension.js.map